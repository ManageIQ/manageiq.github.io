<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ - Example using Tagging for Displaying Pricing and Quota on Service Dialogs</title>
  <meta name="description" content="Introduction">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />

  <script>
    stored_theme = localStorage.getItem('miq-theme');
    theme        = stored_theme && JSON.parse(localStorage.getItem('miq-theme'));

    if (theme === "light-theme") {
      document.querySelector('html').classList.add("light-theme");
    }

    if (theme === "dark-theme") {
      document.querySelector('html').classList.add("dark-theme");
    }
  </script>

  <link type="text/css" rel="stylesheet" href="/assets/main-364a522e6cb5aa31700d9562491465966c2c1081a61b11529597f13bf81cfb69.css">
  <link rel="canonical" href="http://manageiq.org/blog/2023/01/2018-02-07-example-using-tagging-for-displaying-pricing-and-quota-on-service-dialogs/">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li class="active">
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

  </div>
</header>


    <main data-url="/blog/2018/02/example-using-tagging-for-displaying-pricing-and-quota-on-service-dialogs/">
      <div class="blog">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-10">
        <header class="blog_header">
          <h1>
            ManageIQ Blog
          </h1>
        </header>
      </div>
    </div>
    <div class="row"> 
      <div class="col-xs-12 col-sm-10 blog_main">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="page-title" itemprop="name headline">Example using Tagging for Displaying Pricing and Quota on Service Dialogs</h1>

            <div class="post-meta">
              <time datetime="2018-02-07T00:00:00+00:00" itemprop="datePublished">
                Feb 7, 2018
              </time>

              
              <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                by
                <i itemprop="name">
                  John Hardy
                </i>
              </span>
              

              <ul class="post-tags">
                
                <li>
                  <a href="/blog/tags/cloudforms">cloudforms</a>
                </li>
                
              </ul>
            </div>
          </header>

          <div class="post-content" itemprop="articleBody">
            <h2 id="introduction">Introduction</h2>

<p>This post explains a solution whereby Red Hat CloudForms is enabled to show back to the users their remaining tenant budget when ordering services via the service catalog. The implementation uses CloudForms taxonomy and custom methods to display service costs, quota, and a message on the Service Dialog screen.</p>

<h2 id="use-case">Use-Case</h2>

<p>As a user, I wish to be presented the cost of the service I am ordering, along with my current budget and remaining budget when the service is ordered. I would like my budget to be set and maintained at my tenant level.</p>

<h2 id="solution">Solution</h2>

<p>This article describes a possible solution which consists in adding a tab to the service dialog to display required information to the end-user.</p>

<p>You can create a tab for that: the ‘Service Costs’ which contains a number of dynamic elements that retrieve tags from your tenant and service template and calculates the quota status.<br />
Upon ordering, the Service state machine is updated to call a method that updates the remaining budget tag(s) on the tenant. \</p>

<p>In the state pre3 we have connected to an instance/method called “set_your_budget”. Each time a service is ordered the price of that service is deducted from the existing remaining balance tag on the tenant for the user ordering the service.</p>

<h2 id="service-dialog-automation">Service Dialog Automation</h2>

<p>The methods behind the service dialog are as follows;</p>

<ul>
  <li>Cost_of_this_service – This method obtains the cost of the service from a tag assigned to the service.</li>
</ul>

<p>Example Tag: cost_of_this_service_10000 or cost_of_this_service_10</p>

<ul>
  <li>Remaining_budget_after_this_service – This method calculates the subtracting of the cost_of_this_service from the your_budget value.</li>
  <li>Set_your_budget – Called from the state machine to maintain the state of the tags assigned at the tenant for the user ordering the service. Only one tag should exist and will contain the value for the remaining budget.</li>
</ul>

<p>Example Tag : mycompany_budget_9500 or mycompany_budget_10000</p>

<ul>
  <li>Your_budget –  Returns the remaining budget from the tag assigned at the tenant level.</li>
  <li>Status – Returns the status message.</li>
</ul>

<p>Or</p>

<p>There are two tags required to be set for the system to work,</p>

<ul>
  <li>cost_of_this_service_&lt; sum&gt; – This tag you assign to the service template, you can have many of these covering different costs for many services, but only one can exist on any one service at any time. The sum is the cost of that service.</li>
  <li>&lt; companyname&gt;<em>budget</em>&lt; sum&gt; – This tag is the tenant budget, it works by company name that is set in the appliance. Only one tag can exist on any one tenant at any time. The sum is the STARTING budget for the tenant. The solution will dynamically create more tags with the same company prefix, and control the assignment of the tags to the tenant when services are ordered. The budget sum decreases each time a service is ordered by the cost of the service being ordered.</li>
</ul>

<h2 id="implementation">Implementation</h2>

<p>Materials and instructions required to implement this solution are available <a href="https://github.com/jonnyfiveiq/CloudFORMSNOW/tree/master/Billing_Sample">here</a>.</p>

<p>Step 0 – Red Hat Consulting Scripts (pre-requirement)</p>

<p>The Red Hat Consulting import/export scripts will be used in this example. They can be installed on the appliance following instructions on (<a href="https://github.com/rhtconsulting/cfme-rhconsulting-scripts">https://github.com/rhtconsulting/cfme-rhconsulting-scripts</a>)</p>

<p>Step 1 – Clone the Materials</p>

<p>git clone (<a href="https://github.com/jonnyfiveiq/CloudFORMSNOW.git">https://github.com/jonnyfiveiq/CloudFORMSNOW.git</a>)</p>

<p>Step 2 – Import the Tags</p>

<p>miqimport tags CloudFORMSNOW/Billing_Sample/tags/billing.yaml</p>

<p>Step 3 – Import the Sample Dialog</p>

<p>miqimport service_dialogs CloudFORMSNOW/Billing_Sample/dialogs/Billing_Example.yml</p>

<p>Step 4 – Import the Automate domain</p>

<p>miqimport domain Billing CloudFORMSNOW/Billing_Sample/automate/</p>

<p>Step 5 – Import the Sample Service</p>

<p>miqimport service_catalogs CloudFORMSNOW/Billing_Sample/service_catalogs</p>

<p>Step 6 – Tag the Service</p>

<p>We will use the sample tags imported in Step 2.
Select the Service Item “Generic Sample Billing” and tag it with “cost_of_this_service_100”</p>

<p>Step 7 – Tag the Tenant</p>

<p>We will use the sample tags imported in Step 2.</p>

<p>Note, the tenant budget tag is prefixed with the “Company Name” without spaces and lowercase as configured in the CloudForms appliance, if you have changed from the default, you will need to change the tag NAME and VALUE. Example;</p>

<ul>
  <li>Company Name = Red Hat</li>
</ul>

<p>then</p>

<ul>
  <li>Tag name &amp; value = redhat_budget_10000</li>
</ul>

<p>Select your TENANT and tag it with “mycompany_budget_10000”</p>

<p>And with the tag assigned.</p>

<h2 id="validation">Validation</h2>

<p>We can now order the service item from the service catalog.</p>

<p>As part of the service dialog, we can see all pricing and quota information:</p>

<p>Service Costs</p>

<p>Cost of this Service – Show the cost assigned to the service item.</p>

<p>Quota</p>

<p>Current Budget – Shows the Current Budget. If this is the first time Billing is being ran, then the value will be the tag you assigned at the tenant.</p>

<p>Remaining Budget – Is the Current budget minus the service cost.</p>

<p>Message</p>

<p>Status –  Plain English text to show status of quota.
Note: This service item example will not deploy anything, but run the generic state machine and return a success.</p>

<h2 id="debugging-examples">Debugging examples</h2>

<p>In the Automation log on the appliance that is processing the request, you will find the following output from the “set_your_budget” method.</p>

<p>It shows the Tenant name, along with the currently assigned tag and what it will be changing it too.</p>

<p>(&lt;)AEMethod set_your_budget&gt;  STARTED /Billing/Dialogs/DynamicElements/set_your_budget</p>

<p>(&lt;)AEMethod set_your_budget&gt; Tenant Name = My Company</p>

<p>(&lt;)AEMethod set_your_budget&gt; remaining_budget = 9900</p>

<p>(&lt;)AEMethod set_your_budget&gt; your_budget = 10000</p>

<p>(&lt;)AEMethod set_your_budget&gt; Created Tag = mycompany_budget_9900</p>

<p>(&lt;)AEMethod set_your_budget&gt; ASSIGN your_budget_tag = mycompany_budget_9900</p>

<p>(&lt;)AEMethod set_your_budget&gt; UNASSIGN your_budget_tag = mycompany_budget_10000</p>

<p>(&lt;)AEMethod set_your_budget&gt;  ENDED /Billing/Dialogs/DynamicElements/set_your_budget</p>

<p>Possible issues are</p>

<ol>
  <li>No Cost on service = you have not tagged the service with a cost.</li>
  <li>No tenant budget = you have not tagged your tenant with a starting budget.</li>
  <li>enant budget does not change = The company name does not match the tags.</li>
  <li>Nothing being returned, could be automate issues with domain order, locked domain?</li>
</ol>

          </div>
        </article>
      </div>

      <div class="col-xs-12 col-sm-2 blog_side">
          <div class="blog_side-group">
  <h3 class="blog_side-heading">
    Categories
  </h3>

  <ul id="blog_tag_menu" class="blog_menu">
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/announcements">announcements</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/ansible">ansible</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/ansible-tower">ansible-tower</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/api">api</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/appliance">appliance</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/architecture">architecture</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/automate">automate</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/aws">aws</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/azure">azure</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/best-practices">best-practices</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/cloudformation">cloudformation</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/cloudforms">cloudforms</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/cmdb">cmdb</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/collaboration">collaboration</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/compliance">compliance</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/configuration">configuration</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/containers">containers</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/control">control</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/custom-buttons">custom-buttons</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/deployment">deployment</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/developers">developers</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/events">events</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/github">github</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/HA">HA</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/heat">heat</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/integration">integration</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/kubernetes">kubernetes</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/LWIMIQ">LWIMIQ</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/management">management</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/methods">methods</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/microsoft">microsoft</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/openscap">openscap</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/openshift">openshift</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/openstack">openstack</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/operations">operations</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/performance">performance</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/policy">policy</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/provisioning">provisioning</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/pull-request">pull-request</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/rdp">rdp</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/releases">releases</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/rest">rest</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/rhev">rhev</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/ruby">ruby</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/scale">scale</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/security">security</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/self-service">self-service</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/servicenow">servicenow</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/services">services</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/slack">slack</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/sprints">sprints</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/ssh">ssh</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/tutorials">tutorials</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/uxd">uxd</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/vmware">vmware</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/workflows">workflows</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/XML">XML</a>
    </li>
    
  </ul>
</div>

<div class="blog_side-group">
  <h3 class="blog_side-heading">
    Archive
  </h3>

  <ul id="blog_archive_menu" class="blog_menu">
    
    
    

    
    <li class="blog_menu-year">
      <a href="/blog/2023/index.html">
        2023
      </a>
      
        <ul class="blog_menu blog_months">
  
  
  <li class="blog_menu-month">
    <a href="/blog/2023/01/index.html">
      January
    </a>
    
  </li>
  
</ul>

      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2022/index.html">
        2022
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2021/index.html">
        2021
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2020/index.html">
        2020
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2019/index.html">
        2019
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2018/index.html">
        2018
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2017/index.html">
        2017
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2016/index.html">
        2016
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2015/index.html">
        2015
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2014/index.html">
        2014
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2013/index.html">
        2013
      </a>
      
    </li>
    
  </ul>
</div>

      </div>

    </div>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li class="active">
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
      
      <li>
        <a href="https://github.com/ManageIQ/manageiq.org/edit/master/site/_posts/2018-02-07-example-using-tagging-for-displaying-pricing-and-quota-on-service-dialogs.md">
          <i class="fa fa-pencil"></i>
          Edit this page
        </a>
      </li>
      
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2023 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58883457-1', 'auto');
  ga('send', 'pageview');

</script>
    
  </body>
</html>
