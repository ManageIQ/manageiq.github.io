<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />

  <script>
    stored_theme = localStorage.getItem('miq-theme');
    theme        = stored_theme && JSON.parse(localStorage.getItem('miq-theme'));

    if (theme === "light-theme") {
      document.querySelector('html').classList.add("light-theme");
    }

    if (theme === "dark-theme") {
      document.querySelector('html').classList.add("dark-theme");
    }
  </script>

  <link type="text/css" rel="stylesheet" href="/assets/main-c62d712a15a5ba4c8ba8ce3af6a80e7ae432d1bd2c83c7d2973c3d72a7371e97.css">
  <link rel="canonical" href="http://manageiq.org/docs/reference/latest/auth/saml.html">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/reference/fine/auth/saml">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li class="active">
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li>
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

    <div class="col-lg-4 col-md-4 col-sm-12 pull-right" style="margin-top: 10px">
        <script async src="https://cse.google.com/cse.js?cx=006042792541147862616:dfkijfebdts"></script>
         <div class="gcse-search"></div>
    </div>
</nav>

<script>
  window.onload = demo;
	function demo() {
	    document.getElementById("gsc-i-id1").setAttribute("placeholder", "Search Documentation")
	}
</script>

<div class="doc_container">
  <div class="doc_menu">
    
    

<div class="doc_menu-heading">
  Latest
</div>

<ul class="menu menu-toplevel" id=ref_menu_latest>


  <li class="menu-parent">
    
    <a href="#">
      Installation
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_aws/index.html">
      Amazon Web Services (AWS)
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_kubernetes/index.html">
      Kubernetes
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_ibm_cloud/index.html">
      IBM Cloud
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_microsoft_azure/index.html">
      Microsoft Azure
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_google_compute_engine/index.html">
      Google Compute Engine
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_vmware_vsphere/index.html">
      VMware vSphere
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_red_hat_enterprise_linux_openstack_platform/index.html">
      Red Hat Enterprise OpenStack Platform
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_red_hat_virtualization/index.html">
      Red Hat Enterprise Virtualization
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/installing_on_scvmm/index.html">
      Microsoft System Center Virtual Machine Manager (SCVMM)
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Appliances
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/appliances/backup_and_restore.html">
      Backup and Restore
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/appliances/upgrading.html">
      Upgrading
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Configuration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/deployment_planning_guide/index.html">
      Deployment Planning Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/general_configuration/index.html">
      General Configuration
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/high_availability_guide/index.html">
      High Availability Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/appliance_hardening_guide/index.html">
      Appliance Hardening Guide
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Administration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/monitoring_alerts_and_reporting/index.html">
      Monitoring, Alerts, and Reporting
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/policies_and_profiles_guide/index.html">
      Policies and Profiles Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_infrastructure_and_inventory/index.html">
      Managing Infrastructure and Inventory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Managing Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/index.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Infrastructure Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/infrastructure_providers/red_hat_virtualization_providers.html">
      Red Hat Virtualization Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/infrastructure_providers/openstack_infrastructure_providers.html">
      OpenStack Infrastructure Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/infrastructure_providers/vmware_vcenter_providers.html">
      VMware vCenter Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/infrastructure_providers/microsoft_scvmm_providers.html">
      Microsoft SCVMM Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/infrastructure_providers/ibm_power_hmc_providers.html">
      IBM Power HMC Providers
    </a>
    
  </li>


    </ul>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Configuration Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/configuration_management_providers/ibm_terraform_provider.html">
      IBM Terraform Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/configuration_management_providers/red_hat_satellite_6.html">
      Red Hat Satellite 6 Providers
    </a>
    
  </li>


    </ul>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Cloud Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/azure_providers.html">
      Azure Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/amazon_ec2_providers.html">
      Amazon EC2 Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/google_compute_engine_providers.html">
      Google Compute Engine Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/ibm_cloud_vpc_providers.html">
      IBM Cloud VPC Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/ibm_power_systems_virtual_servers_providers.html">
      IBM Power Systems Virtual Servers Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/ibm_power_vc_providers.html">
      IBM PowerVC Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/cloud_providers/openstack_providers.html">
      OpenStack Providers
    </a>
    
  </li>


    </ul>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Container Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/containers_providers/azure_kubernetes_providers.html">
      Azure Kubernetes Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/containers_providers/red_hat_openshift_providers.html">
      Red Hat OpenShift Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/containers_providers/ibm_cloud_kubernetes_service_providers.html">
      IBM Cloud Kubernetes Service Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/containers_providers/oracle_kubernetes_engine_providers.html">
      Oracle Kubernetes Engine Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/containers_providers/vmware_tanzu_providers.html">
      VMware Tanzu Providers
    </a>
    
  </li>


    </ul>
    
  </li>

  
  
  
  <li class="doc_menu-item menu-parent">
    <a href="#">
      Storage Providers
    </a>
    
    <ul>
      



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/storage_providers/amazon_ebs_managers.html">
      Amazon Elastic Block Store Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/storage_providers/openstack_block_storage_managers.html">
      OpenStack Block Storage Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/storage_providers/openstack_object_storage_managers.html">
      OpenStack Object Storage Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/managing_providers/storage_providers/ibm_cloud_object_storage_managers.html">
      IBM Cloud Object Storage Providers
    </a>
    
  </li>


    </ul>
    
  </li>


    </ul>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/provisioning_virtual_machines_and_hosts/index.html">
      Provisioning Virtual Machines and Hosts
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/scripting_actions/index.html">
      Scripting Actions in ManageIQ
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Troubleshooting
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/troubleshooting/index.html">
      Troubleshooting
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Authentication
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/active_directory.html">
      Active Directory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ipa_2fa.html">
      2-Factor-Authentication with IPA
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ipa_ad_trust.html">
      IPA/AD Trust
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ldap.html">
      LDAP
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/saml.html">
      SAML
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/openid_connect.html">
      OpenID-Connect
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Integration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/integration_with_aws_cloudformation_and_openstack_heat/index.html">
      AWS CloudFormation and OpenStack Heat
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/integration_with_servicenow/index.html">
      ServiceNow
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Reference
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/capabilities_matrix/index.html">
      Capabilities Matrix
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/api">
      ManageIQ REST API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/methods_available_for_automation/index.html">
      Methods Available for Automation
    </a>
    
  </li>


      </ul>
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc user_doc">
      

      <div class="doc-content">
        
        <div class="doc-versions">
          <span class="label">Versions: </span>
          
            <span class="active" >
              <a href="/docs/reference/latest/auth/saml.html">
                Latest
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/quinteros/auth/saml.html">
                Quinteros
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/petrosian/auth/saml.html">
                Petrosian
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/oparin/auth/saml.html">
                Oparin
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/najdorf/auth/saml.html">
                Najdorf
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/morphy/auth/saml.html">
                Morphy
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/lasker/auth/saml.html">
                Lasker
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/kasparov/auth/saml.html">
                Kasparov
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/jansa/auth/saml.html">
                Jansa
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/ivanchuk/auth/saml.html">
                Ivanchuk
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/hammer/auth/saml.html">
                Hammer
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/gaprindashvili/auth/saml.html">
                Gaprindashvili
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/fine/auth/saml.html">
                Fine
              </a>
            </span>
            
              <span class="separator">/</span>
            
          
            <span>
              <a href="/docs/reference/euwe/auth/saml.html">
                Euwe
              </a>
            </span>
            
          
        </div>
        
        <div class="sect1">
<h2 id="saml"><a class="anchor" href="#saml"></a>SAML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External Authentication on the Appliance has been enhanced to support SAML.
The SAML implementation has been tested with KeyCloak 1.8.</p>
</div>
<div class="paragraph">
<p>In this guide we will cover how to manually configure an Appliance&#8217;s
external authentication to work with SAML. The SAML implementation has been
tested with KeyCloak but is implemented generically using Apache&#8217;s mod_auth_mellon
module and should work with other SAML Identity Providers.</p>
</div>
<div class="paragraph">
<p>The current implementation only secures the Appliance&#8217;s Web administrative UI with SAML.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The REST API and Self-Service UI do not currently support SAML.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#requirements">Requirements</a></p>
</li>
<li>
<p><a href="#configuring-saml">Configuring SAML</a></p>
</li>
<li>
<p><a href="#configuring-admin-ui">Configuring the Administrative UI</a></p>
</li>
<li>
<p><a href="#re-enabling-local-login">Re-Enabling Local Login</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is needed in order to enable SAML Authentication to the Appliance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A CentOS/RHEL 7.2 based Appliance</p>
</li>
<li>
<p>A SAML Identity Provider, (e.g. KeyCloak 1.8 or Later)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-saml"><a class="anchor" href="#configure-saml"></a>Configure SAML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All SAML related certificates and keys are accessed from /etc/httpd/saml2/</p>
</div>
<div class="paragraph">
<p>First ssh to the appliance as root, then create that directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># mkdir -p /etc/httpd/saml2</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="apache-configuration"><a class="anchor" href="#apache-configuration"></a>Apache Configuration</h3>
<div class="paragraph">
<p>Copy the Apache remote user and SAML template configuration files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># TEMPLATE_DIR="/var/www/miq/system/TEMPLATE"
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user.conf        \
    /etc/httpd/conf.d/
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth-saml.conf \
    /etc/httpd/conf.d/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="saml-configuration"><a class="anchor" href="#saml-configuration"></a>SAML Configuration</h3>
<div class="paragraph">
<p>Notable defaults in the <em>manageiq-external-auth-saml.conf</em> file:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Identity Provider Files</strong> (i.e. KeyCloak)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/httpd/saml2/idp-metadata.xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Service Provider Files</strong> (i.e. mod_auth_mellon)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private Key File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/httpd/saml2/miqsp-key.key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/httpd/saml2/miqsp-cert.cert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/httpd/saml2/miqsp-metadata.xml</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other mod_auth_mellon parameters must not be modified as the Appliance expects them
to be defined as such, i.e. End points, Protected URL, etc.</p>
</div>
<div class="paragraph">
<p>For the Service Provider files on the Appliance, these can be generated using
the mod_auth_mellon command <em>mellon_create_metadata.sh</em> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># cd /etc/httpd/saml2
# /usr/libexec/mod_auth_mellon/mellon_create_metadata.sh https://&lt;miq-appliance&gt; https://&lt;miq-appliance&gt;/saml2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mellon_create_metadata.sh script creates file names based on the appliance URL but
can be renamed to match the expected file names from the <em>manageiq-external-auth-saml.conf</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># mv https_&lt;miq-appliance&gt;.key  miqsp-key.key
# mv https_&lt;miq-appliance&gt;.cert miqsp-cert.cert
# mv https_&lt;miq-appliance&gt;.xml  miqsp-metadata.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the service provider metadata.xml file generated, the Service Provider definition
can now be defined in the Identity Provider.</p>
</div>
<div class="paragraph">
<p>For KeyCloak, a Realm can be created for one or more Appliances with individual Clients
defined one per Appliance where the Client ID is essentially the URL of the appliance.</p>
</div>
<div class="paragraph">
<p>Adding a Client in the KeyCloak ManageIQ Realm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select and Import the miqsp-metadata.xml file created for mod_auth_mellon.</p>
</li>
<li>
<p>Set Client ID as <a href="https://&lt;miq-appliance>" class="bare">https://&lt;miq-appliance></a></p>
</li>
<li>
<p>Set Client protocol as <strong>saml</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Client definition for the appliance can then be updated with the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name ID Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid Redirect URIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance&gt;/saml2/postResponse" class="bare">https://&lt;miq-appliance&gt;/saml2/postResponse</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master SAML Processing URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance&gt;/saml2" class="bare">https://&lt;miq-appliance&gt;/saml2</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assertion Consumer Service POST Binding URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance&gt;/saml2/postResponse" class="bare">https://&lt;miq-appliance&gt;/saml2/postResponse</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout Service Redirect Binding URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance&gt;/saml2/logout" class="bare">https://&lt;miq-appliance&gt;/saml2/logout</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Identity Provider&#8217;s Metadata file idp-metadata.xml can then be obtained as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># cd /etc/httpd/saml2
# curl -s -o idp-metadata.xml \
    http://&lt;keycloak-server&gt;:8080/auth/realms/&lt;miq-realm&gt;/protocol/saml/descriptor</code></pre>
</div>
</div>
<div class="paragraph">
<p>As of this writing, the following change is necessary for the SAML Logout to work between
mod_auth_mellon and KeyCloak:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># vi idp-metadata.xml

  ...
  &lt;SingleLogoutService
&lt;   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
---
&gt;   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
    Location=
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, restart Apache on the appliance as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># systemctl restart httpd</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="saml-assertions"><a class="anchor" href="#saml-assertions"></a>SAML Assertions</h4>
<div class="paragraph">
<p>For authenticating to the appliance, the following remote user parameters are looked at by
the appliance upon a successful login and redirect from the Identity Provider.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Environment</th>
<th class="tableblock halign-left valign-top">SAML Assertion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_EMAIL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_FIRSTNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_LASTNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_FULLNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_GROUPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For KeyCloak, the above SAML Assertions can be defined for the Appliance Client in KeyCloak as
Mappers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeStatement Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeStatement Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeStatement Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeStatement Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeStatement Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group Mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note:</strong> the fullName attribute was not available in the default database as of this writing
and was added as a user attribute.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-admin-ui"><a class="anchor" href="#configure-admin-ui"></a>Configure Administrative UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After having configured Apache for SAML, the next step is to update the Appliance Administrative UI
to be SAML aware and function accordingly.</p>
</div>
<div class="paragraph">
<p>Login as admin, then in <em>Configure&#8594;Configuration&#8594;Authentication</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set mode to External (httpd)</p>
</li>
<li>
<p>Check: <em>Enable SAML</em> - This will enable the SAML login button on the login screen, the redirects
to the SAML protected page for authentication as well as supporting the SAML logout process.</p>
</li>
<li>
<p>Check: <em>Enable Single Signon</em> - With this option enabled, initial access to the Appliance Administrative UI will
redirect to the SAML Identity Provider authentication screen.  Note that logouts from the Appliance will
return the user to the Appliance login screen allowing them to login as admin unless <em>Disable Local Login</em>
is checked below.</p>
</li>
<li>
<p>Optional: Check: <em>Disable Local Login</em> - Do this <strong>only</strong> if you need to disable <em>admin</em> login to appliance and only
allow SAML based authentication.  Note that if there are issues with the Identity Provider or you need
admin access to the appliance you won&#8217;t be able to login until you re-enable the Local Login
as described below.</p>
</li>
<li>
<p>Check: <em>Get User Groups from External Authentication (httpd)</em></p>
</li>
<li>
<p>Click Save.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above steps need to be done on each UI enabled appliance.</p>
</div>
<div class="paragraph">
<p>in <em>Configure&#8594;Configuration&#8594;Access Control</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the user&#8217;s groups are created on the Appliance and appropriate roles assigned to those groups.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="re-enabling-local-login"><a class="anchor" href="#re-enabling-local-login"></a>Re-Enabling Local Login</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Local Login has been disabled in the Administrative UI and there is a need to be able
to login as <em>admin</em>, the Local Login can be re-enabled as follows:</p>
</div>
<div class="sect2">
<h3 id="administrative-ui"><a class="anchor" href="#administrative-ui"></a>Administrative UI:</h3>
<div class="paragraph">
<p>This option is available if the Identity Provider is available and one can login using a user
with enough administrative privileges to update it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login as administrative user,</p>
</li>
<li>
<p>In then in <em>Configure&#8594;Configuration&#8594;Authentication</em> uncheck <em>Disable Local Login</em> and save.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="appliance-console-interface"><a class="anchor" href="#appliance-console-interface"></a>Appliance Console Interface:</h3>
<div class="ulist">
<ul>
<li>
<p>ssh to the appliance as root</p>
</li>
<li>
<p>Run <em>appliance_console</em></p>
</li>
<li>
<p>Select menu entry <em>Update External Authentication Options</em></p>
</li>
<li>
<p>Select <em>Enable Local Login</em></p>
</li>
<li>
<p>then <em>Apply updates</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="appliance-console-cli"><a class="anchor" href="#appliance-console-cli"></a>Appliance Console CLI:</h3>
<div class="ulist">
<ul>
<li>
<p>ssh to the appliance as root</p>
</li>
<li>
<p>Run <em>appliance_console_cli --extauth-opts</em> <strong>local_login_disabled=false</strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="https://github.com/orgs/ManageIQ/discussions">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
      
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2024 ManageIQ.
      </span>
      <span>
        <a href="https://www.ibm.com/opensource/" target="_blank">
          Sponsored by IBM, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58883457-1', 'auto');
  ga('send', 'pageview');

</script>
    
  </body>
</html>
