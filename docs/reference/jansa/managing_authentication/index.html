<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />

  <link type="text/css" rel="stylesheet" href="/assets/main-8de063b063e781c83c3900f2fb42692885edeac0346d54e22467184ccc393942.css">
  <link rel="canonical" href="http://manageiq.org/docs/reference/latest/managing_authentication/">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/reference/jansa/managing_authentication/index">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li class="active">
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li>
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

    <div class="col-lg-4 col-md-4 col-sm-12 pull-right" style="margin-top: 10px">
        <script async src="https://cse.google.com/cse.js?cx=006042792541147862616:dfkijfebdts"></script>
         <div class="gcse-search"></div>
    </div>
</nav>

<script>
  window.onload = demo;
	function demo() {
	    document.getElementById("gsc-i-id1").setAttribute("placeholder", "Search Documentation")
	}
</script>

<div class="doc_container">
  <div class="doc_menu">
    
    

<div class="doc_menu-heading">
  Jansa
</div>

<ul class="menu menu-toplevel" id=ref_menu_jansa>


  <li class="menu-parent">
    
    <a href="#">
      Installation
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_aws/index.html">
      Amazon Web Services (AWS)
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_microsoft_azure/index.html">
      Microsoft Azure
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_google_compute_engine/index.html">
      Google Compute Engine
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_vmware_vsphere/index.html">
      VMware vSphere
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_red_hat_enterprise_linux_openstack_platform/index.html">
      Red Hat Enterprise OpenStack Platform
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_red_hat_virtualization/index.html">
      Red Hat Enterprise Virtualization
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/installing_on_scvmm/index.html">
      Microsoft System Center Virtual Machine Manager (SCVMM)
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Configuration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/deployment_planning_guide/index.html">
      Deployment Planning Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/general_configuration/index.html">
      General Configuration
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/high_availability_guide/index.html">
      High Availability Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/appliance_hardening_guide/index.html">
      Appliance Hardening Guide
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Administration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/monitoring_alerts_and_reporting/index.html">
      Monitoring, Alerts, and Reporting
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/policies_and_profiles_guide/index.html">
      Policies and Profiles Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/managing_infrastructure_and_inventory/index.html">
      Managing Infrastructure and Inventory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/managing_providers/index.html">
      Managing Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/provisioning_virtual_machines_and_hosts/index.html">
      Provisioning Virtual Machines and Hosts
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/scripting_actions/index.html">
      Scripting Actions in ManageIQ
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Authentication
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/active_directory.html">
      Active Directory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/ipa_2fa.html">
      2-Factor-Authentication with IPA
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/ipa_ad_trust.html">
      IPA/AD Trust
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/ldap.html">
      LDAP
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/saml.html">
      SAML
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/auth/openid_connect.html">
      OpenID-Connect
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Integration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/integration_with_aws_cloudformation_and_openstack_heat/index.html">
      AWS CloudFormation and OpenStack Heat
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/integration_with_servicenow/index.html">
      ServiceNow
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Reference
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/rest_api/index.html">
      ManageIQ REST API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/jansa/methods_available_for_automation/index.html">
      Methods Available for Automation
    </a>
    
  </li>


      </ul>
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc user_doc">
      

      <div class="doc-content">
        
        <div class="doc-versions">
          <span class="label">Versions: </span>
          
        </div>
        
        <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#managing-authentication-for-cloudforms">Managing Authentication for CloudForms</a></li>
<li class="toc-entry toc-h1"><a href="#introduction-to-authentication-in-manageiq">Introduction to Authentication in ManageIQ</a>
<ul>
<li class="toc-entry toc-h2"><a href="#configuring-authentication-settings-in-manageiq">Configuring Authentication Settings in ManageIQ</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#configuring-ldap-authentication-with-idm-and-active-directory">Configuring LDAP Authentication with IdM and Active Directory</a>
<ul>
<li class="toc-entry toc-h2"><a href="#configuring-ldap-or-ldaps-authentication">Configuring LDAP or LDAPS Authentication</a></li>
<li class="toc-entry toc-h2"><a href="#adding-trusted-forests">Adding Trusted Forests</a></li>
<li class="toc-entry toc-h2"><a href="#assigning-manageiq-account-roles-using-ldap-groups">Assigning ManageIQ Account Roles Using LDAP Groups</a>
<ul>
<li class="toc-entry toc-h3"><a href="#mapping-existing-ldap-groups-to-manageiq-user-account-roles">Mapping Existing LDAP Groups to ManageIQ User Account Roles</a></li>
<li class="toc-entry toc-h3"><a href="#creating-ldap-groups-based-on-manageiq-account-roles">Creating LDAP Groups Based on ManageIQ Account Roles</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#configuring-lookup-priority-for-ldap-groups">Configuring Lookup Priority for LDAP Groups</a></li>
<li class="toc-entry toc-h2"><a href="#testing-ldap-configuration">Testing LDAP Configuration</a></li>
<li class="toc-entry toc-h2"><a href="#troubleshooting-ldap-configuration">Troubleshooting LDAP Configuration</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#configuring-aws-identity-and-access-management-iam-authentication">Configuring AWS Identity and Access Management (IAM) Authentication</a></li>
<li class="toc-entry toc-h1"><a href="#configuring-identity-management-external-authentication-with-manageiq">Configuring Identity Management (External Authentication) with ManageIQ</a>
<ul>
<li class="toc-entry toc-h2"><a href="#configuring-authentication-with-ipa">Configuring Authentication with IPA</a>
<ul>
<li class="toc-entry toc-h3"><a href="#external-authentication-requirements">External Authentication Requirements</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-the-appliance-for-external-authentication">Configuring the Appliance for External Authentication</a></li>
<li class="toc-entry toc-h3"><a href="#reverting-to-internal-database-authentication">Reverting to Internal Database Authentication</a></li>
<li class="toc-entry toc-h3"><a href="#optional-configuration-using-the-appliance-console-cli">Optional Configuration Using the Appliance Console CLI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#configuring-authentication-with-active-directory">Configuring Authentication with Active Directory</a>
<ul>
<li class="toc-entry toc-h2"><a href="#connecting-manageiq-to-an-active-directory-domain">Connecting ManageIQ to an Active Directory Domain</a></li>
<li class="toc-entry toc-h2"><a href="#mapping-active-directory-users-to-manageiq-user-roles">Mapping Active Directory Users to ManageIQ User Roles</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#configuring-federated-authentication-with-saml">Configuring Federated Authentication with SAML</a>
<ul>
<li class="toc-entry toc-h2"><a href="#configuring-authentication-with-saml-and-red-hat-single-sign-on-rh-sso">Configuring Authentication with SAML and Red Hat Single Sign-On (RH-SSO)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#configuring-the-http-server-for-saml-authentication-with-red-hat-single-sign-on-rh-sso">Configuring the HTTP Server for SAML Authentication with Red Hat Single Sign-On (RH-SSO)</a></li>
<li class="toc-entry toc-h3"><a href="#configuring-saml-authentication-in-the-manageiq-user-interface">Configuring SAML Authentication in the ManageIQ User Interface</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#saml-assertions">SAML Assertions</a></li>
<li class="toc-entry toc-h2"><a href="#re-enabling-local-login-optional">Re-enabling Local Login (Optional)</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#troubleshooting-external-authentication-configuration">Troubleshooting External Authentication Configuration</a>
<ul>
<li class="toc-entry toc-h2"><a href="#additional-troubleshooting-tips">Additional Troubleshooting Tips</a></li>
</ul>
</li>
</ul><h1 id="managing-authentication-for-cloudforms">
<a class="anchor" href="#managing-authentication-for-cloudforms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Managing Authentication for CloudForms</h1>

<h1 id="introduction-to-authentication-in-manageiq">
<a class="anchor" href="#introduction-to-authentication-in-manageiq" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction to Authentication in ManageIQ</h1>

<p>ManageIQ provides several methods to authenticate users.
Authentication can be configured from ManageIQ using the
local database, or ManageIQ can use protocols such as LDAP
and SAML to connect to a pre-configured authentication system such as
Red Hat Identity Management (IdM), Red Hat Single Sign-On (SSO), Active
Directory (AD), or AWS Identity and Access Management (IAM) to use
existing user accounts and groups.</p>

<p>This guide provides instructions to configure authentication management
in your ManageIQ environment as an administrative user.</p>

<p>After completing the setup of an authentication system, users can log in
with their credentials.</p>

<div class="note">

For further information on managing users, groups, and account roles,
see [Access
Control](https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/general_configuration/#access-control)
in *General Configuration*.

</div>

<h2 id="configuring-authentication-settings-in-manageiq">
<a class="anchor" href="#configuring-authentication-settings-in-manageiq" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Authentication Settings in ManageIQ</h2>

<p>As the admin user, configure your authentication method from the
<strong>Authentication</strong> tab in the <strong>Configuration</strong> menu.</p>

<p>To change authentication settings:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Use <strong>Session Timeout</strong> to set the period of inactivity before a
user is logged out of the console.</p>
  </li>
  <li>
    <p>Set the authentication method in <strong>Mode</strong> from the following
methods:</p>

    <ul>
      <li>
        <p>To configure authentication locally using the Virtual Management
Database (VMDB), choose <strong>Database</strong>. This is the default
method. See <a href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.5/html-single/general_configuration/#creating_a_user">Creating a
User</a>
in <em>General Configuration</em> to create users from
ManageIQ.</p>
      </li>
      <li>
        <p>To configure LDAP-based authentication to use with IdM or Active
Directory, choose <strong>LDAP</strong> or <strong>LDAPS</strong>, see
<a href="#ldap_settings">???</a> for configuration steps.</p>
      </li>
      <li>
        <p>To configure Amazon AWS Identity and Access Management (IAM)
authentication, choose <strong>Amazon</strong>, see <a href="#amazon_settings">???</a>
for configuration steps.</p>
      </li>
      <li>
        <p>To configure federated authentication to use with IdM or Red Hat
Single Sign-On (SSO), choose <strong>External (httpd)</strong> and follow the
steps for your authentication method in <a href="#external_auth">???</a>.</p>
      </li>
    </ul>
  </li>
</ol>

<h1 id="configuring-ldap-authentication-with-idm-and-active-directory">
<a class="anchor" href="#configuring-ldap-authentication-with-idm-and-active-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring LDAP Authentication with IdM and Active Directory</h1>

<p>Select <strong>LDAP</strong> or <strong>LDAPS</strong> to configure ManageIQ
authentication using Red Hat Identity Management (IdM), Active
Directory, or another identity management service that uses LDAP
protocol.</p>

<p>If you choose LDAP or LDAPS as your authentication mode, the required
parameters are exposed under <strong>LDAP Settings</strong>. Be sure to validate your
settings before saving them.</p>

<div class="important">

This procedure requires a preconfigured authentication system such as
Red Hat Identity Management (IdM) or Active Directory (AD) with user
groups configured.

</div>

<p>LDAP authentication for ManageIQ requires group membership
to be defined by the LDAP RFC 2307 schema, where group members are
listed by name in the member UID attribute.</p>

<p>For more information about Red Hat Identity Management, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/index">Linux
Domain Identity, Authentication, and Policy
Guide</a>
and related Red Hat Enterprise Linux documentation.</p>

<h2 id="configuring-ldap-or-ldaps-authentication">
<a class="anchor" href="#configuring-ldap-or-ldaps-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring LDAP or LDAPS Authentication</h2>

<p>To configure ManageIQ to use LDAP for authentication:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Select a <strong>Session Timeout</strong> to set the period of inactivity before
a user is logged out of the console.</p>
  </li>
  <li>
    <p>Select <strong>LDAP</strong> or <strong>LDAPS</strong> from the <strong>Mode</strong> list. This exposes
additional required parameters under <strong>LDAP Settings</strong>.</p>
  </li>
  <li>
    <p>Configure your <strong>LDAP Settings</strong> (the following example configures
an IdM directory server):</p>

    <ul>
      <li>
        <p>Use <strong>LDAP Host Names</strong> to specify the fully qualified domain
names of your directory servers. ManageIQ will
search each host name in order until it finds one that
authenticates the user. Note, ManageIQ supports
using a maximum of three possible <strong>LDAP Host Names</strong>.</p>
      </li>
      <li>
        <p>Use <strong>LDAP Port</strong> to specify the port for your directory server.
The default is 389 for LDAP and 636 for LDAPS.</p>
      </li>
      <li>
        <p>From the <strong>User Type</strong> list, select one of the following and
configure the values for your directory server:</p>

        <ul>
          <li>
            <p><strong>User Principal Name</strong>: Type the user name in the format of
<em>user@domainname</em>, for example, <em>dbright@acme.com</em>. (In this
case, the user would log on as <em>dbright</em>.)</p>
          </li>
          <li>
            <p><strong>Email Address</strong>: Logs in with the user’s email address.</p>
          </li>
          <li>
            <p><strong>Distinguished Name</strong> (CN=&lt;user&gt;): Uses the common name
for the user. Be sure to enter the correct <strong>User Suffix</strong>
and <strong>Distinguished Name</strong> option for your directory service
implementation: for example, <em>cn=dan
bright,ou=users,dc=acme,dc=com</em>. (The user logs on as <em>dan
bright</em>.)</p>
          </li>
          <li>
            <p><strong>Distinguished Name</strong> (UID=&lt;user&gt;): Uses the user ID
(UID). Be sure to enter the correct <strong>User Suffix</strong> and
<strong>Distinguished Name</strong> option for your directory service
implementation: for example, <em>uid=dan
bright,ou=users,dc=acme,dc=com</em>. (The user logs on as <em>dan
bright</em>.)</p>
          </li>
          <li>
            <p><strong>SAM Account Name</strong>: User logon for Active Directory
clients and servers using legacy Windows versions. You must
also configure the <strong>Domain Prefix</strong> in the next field when
selecting this option.</p>
          </li>
        </ul>
      </li>
      <li>
        <p>Specify the <strong>Domain Prefix</strong> if you are configuring an Active
Directory LDAP host, and selected <strong>SAM Account Name</strong> as the
<strong>User Type</strong>. This field represents the prefix name in the
Active Directory domain. Together with the SAM account name,
this constructs the fully qualified user name in the format
<code class="language-plaintext highlighter-rouge">&lt;domain_prefix&gt;\&lt;user&gt;</code>.</p>
      </li>
      <li>
        <p>Specify the <strong>User Suffix</strong>, such as <em>acme.com</em> for <strong>User
Principal Name</strong> or <em>cn=users,dc=acme,dc=com</em> for
<strong>Distinguished Name</strong>, in <strong>Base DN</strong>.</p>

        <div class="note">

The `ldapsearch(1)` command can be used to get details of your
LDAP settings. To get details related to a specific user, run:

    # ldapsearch -D "cn=directory manager" -H ldap://www.acme.com:389 -b "dc=acme,dc=com" -s sub "(objectclass=*)" -w password | grep -i dbright

To search for your directory server’s distinguished name (DN)
values, run:

    # ldapsearch -D "cn=directory manager" -H ldap://www.acme.com:389 -b "dc=acme,dc=com" -s sub "(objectclass=*)" -w password

</div>

        <p><strong>Example: LDAP Configuration.</strong></p>

        <p><img src="../images/ldap-authentication-full.png" alt="ldap authentication
full"></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Configure your <strong>Role Settings</strong>: In both LDAP and LDAPS, you can
use groups from your directory service to set the role for the
authenticated LDAP user. The LDAP user must be assigned one of the
account role groups. See <a href="#assigning_account_roles_using_ldap_groups">Assigning ManageIQ Account
Roles Using LDAP Groups</a>
for more information.</p>

    <ul>
      <li>
        <p>For LDAP users not belonging to a group:</p>

        <ul>
          <li>Select a ManageIQ group from the <strong>Default
Group for Users</strong> list. This default group can be used for
all LDAP users who use LDAP for authentication only. Do not
select <strong>Get User Groups from LDAP</strong>, which will hide the
<strong>Default Group for Users</strong> option.</li>
        </ul>
      </li>
      <li>
        <p>For LDAP users belonging to a group:</p>

        <ul>
          <li>
            <p>Select <strong>Get User Groups from LDAP</strong> to retrieve the user’s
group membership from LDAP. This looks up all groups in the
directory server for the user attempting to log in. This
group list is matched against the available groups
configured in ManageIQ. Once a match is found,
the role associated with the matching group identifies the
authority the user will have on ManageIQ. This
requires group names on the directory server to match
ManageIQ group names. Selecting this box
enables user records to be automatically created in
ManageIQ when a user logs in.</p>

            <div class="important">

If you do not select **Get User Groups from LDAP**, the user
must be defined in the VMDB where the User ID is the same as
the user’s name in your directory service typed in
lowercase. See [Creating a
User](https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/general_configuration/#creating_a_user)
in *General Configuration* for steps on creating users.

</div>

            <div class="note">

If your LDAP directory uses the `groupMembership` attribute
to contain a user’s group membership, you can use a
multi-value attribute to look up a user’s groups in
ManageIQ. This is not the default
ManageIQ behaviour, and must be enabled
manually in the advanced settings. After configuring your
LDAP settings, update the default ManageIQ
LDAP configuration to support `groupMembership` in
menu:Configuration\[Settings \&gt; Advanced\] by changing
`group_attribute: memberof` to `:group_attribute:
groupmembership`.

</div>
          </li>
          <li>
            <p>Select <strong>Get Groups from Home Forest</strong> to use the LDAP
groups from the LDAP user’s home forest. This will allow you
to discover groups on your directory server and create
ManageIQ groups based on your directory
server’s group names. Any user logging in will be assigned
to that group. This option is only displayed when <strong>Get User
Groups from LDAP</strong> is selected.</p>

            <div class="note">

In most environments, it is recommended to select both the
**Get User Groups from LDAP** and **Get Groups from Home
Forest** options.

</div>
          </li>
          <li>
            <p>Select <strong>Follow Referrals</strong> to look up and bind a user that
exists in a domain other than the one configured in the LDAP
authentication settings.</p>
          </li>
          <li>
            <p>Specify the user name to bind to the directory server in
<strong>Bind DN</strong>. This user must have read access to all users
and groups that will be used for ManageIQ
authentication and role assignment, for example, a service
account user with access to all LDAP users (named <em>svc-ldap</em>
in this example).</p>
          </li>
          <li>
            <p>Enter the password for the Bind DN user in <strong>Bind
Password</strong>.</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Click <strong>Validate</strong> to verify your settings.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<p>LDAP authentication is now configured in your ManageIQ
environment.</p>

<p>To use a multi-value attribute to look up LDAP group membership, update
the <code class="language-plaintext highlighter-rouge">group_attribute</code> field in the ManageIQ advanced
settings. In menu:Configuration[Settings &gt; Advanced], change
<code class="language-plaintext highlighter-rouge">group_attribute: memberof</code> to <code class="language-plaintext highlighter-rouge">:group_attribute: groupmembership</code>.</p>

<p>To assign account roles using LDAP groups, see <a href="#assigning_account_roles_using_ldap_groups">Assigning
ManageIQ Account Roles Using LDAP
Groups</a>.</p>

<h2 id="adding-trusted-forests">
<a class="anchor" href="#adding-trusted-forests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding Trusted Forests</h2>

<p>Optionally, if a user has group memberships in another LDAP forest,
specify the settings to access the memberships in the trusted forest.</p>

<p>When trusted forests are added to the authentication configuration, they
are used only for finding groups that a user is a member of.
ManageIQ will first collect all of the user’s groups from
the primary LDAP directory. Then it will collect any additional groups
that the user is a member of from all of the configured forests.</p>

<p>The collected LDAP groups are used to match, by name, against the groups
defined in ManageIQ. The user must be a member of at least
one matching LDAP group to be successfully authenticated.</p>

<p>To add another trusted forest:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Select <strong>Get User Groups from LDAP</strong>, and enter all items in the
<strong>Role Settings</strong> area.</p>
  </li>
  <li>
    <p>In the <strong>Trusted Forest Settings</strong> area, click <img src="../images/green-plus.png" alt="green
plus">(<strong>Click to add a new forest</strong>).</p>
  </li>
  <li>
    <p>Enter the <strong>LDAP Host Name</strong>, select a <strong>Mode</strong>, and enter an <strong>LDAP
Port</strong>, <strong>Base DN</strong>, <strong>Bind DN</strong>, and <strong>Bind Password</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<p>After adding other trusted LDAP forests, you can then change the order
in which ManageIQ looks up the forests for authentication.
For instructions, see <a href="#ldap_lookup_priority">Configuring Lookup Priority for LDAP
Groups</a>.</p>

<h2 id="assigning-manageiq-account-roles-using-ldap-groups">
<a class="anchor" href="#assigning-manageiq-account-roles-using-ldap-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Assigning ManageIQ Account Roles Using LDAP Groups</h2>

<p>After configuring LDAP authentication as described in <a href="#ldap_settings">Configuring LDAP
Authentication with IdM and Active Directory</a>, you can
associate ManageIQ account roles with your LDAP users. The
LDAP directory server defines the groups and users for
ManageIQ, while ManageIQ defines the account
roles, and maps the roles to the privileges the LDAP user has.</p>

<p>There are two ways to associate your LDAP groups with
ManageIQ account roles:</p>

<ul>
  <li>
    <p>Create groups in ManageIQ that match your existing
LDAP groups by name, and assign the groups account roles; or</p>
  </li>
  <li>
    <p>Create groups on your directory server based on the default account
roles in ManageIQ.</p>
  </li>
</ul>

<p>The users in your LDAP groups then inherit the ManageIQ
account roles for the LDAP group(s) they are in.</p>

<p>The authentication process then happens as such:</p>

<ol>
  <li>
    <p><em>LDAPuser1</em> attempts to log into ManageIQ, so
ManageIQ queries the directory server to verify it
knows <em>LDAPuser1</em>.</p>
  </li>
  <li>
    <p>The directory server then confirms that it knows <em>LDAPuser1</em>, and
provides information about the LDAP groups <em>LDAPuser1</em> belongs to:
<em>Group1</em>.</p>
  </li>
  <li>
    <p>ManageIQ then looks up <em>Group1</em>, and discovers that
<em>Group1</em> is associated with <em>Role1</em>.</p>
  </li>
  <li>
    <p>ManageIQ then associates <em>LDAPuser1</em> with <em>Group1</em> in
ManageIQ, and then allows the user to perform tasks
allowable by that role.</p>
  </li>
</ol>

<h3 id="mapping-existing-ldap-groups-to-manageiq-user-account-roles">
<a class="anchor" href="#mapping-existing-ldap-groups-to-manageiq-user-account-roles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapping Existing LDAP Groups to ManageIQ User Account Roles</h3>

<p>This section provides instructions for mapping your existing LDAP groups
to account roles in ManageIQ. As a result, the users in
the LDAP group will then be assigned to the ManageIQ roles
associated with that group.</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Click the <strong>Access Control</strong> accordion, then click <strong>Groups</strong>.</p>
  </li>
  <li>
    <p>Click <img src="../images/1847.png" alt="1847"> (<strong>Configuration</strong>), and <img src="../images/plus_green.png" alt="plus
green"> (<strong>Add a new Group</strong>) to create a
group.</p>
  </li>
  <li>
    <p>There are two ways to specify the group to use:</p>

    <ul>
      <li>
        <p>In the <strong>Description</strong> field, enter the common name (<em>cn</em>) for
your existing LDAP group assigned to users requiring access to
ManageIQ.</p>
      </li>
      <li>
        <p>Select <strong>Look Up LDAP Groups</strong> to find a list of groups assigned
to a specific user in LDAP, then use the <strong>LDAP Group for User</strong>
list to choose a group.</p>

        <ol>
          <li>
            <p>In <strong>User to Look Up</strong>, enter the common name (<em>cn</em>) for a
user in your LDAP group.</p>
          </li>
          <li>
            <p>Enter the <strong>Username</strong>.</p>
          </li>
          <li>
            <p>In <strong>Password</strong>, enter the user’s password. Click
<strong>Retrieve</strong>.</p>
          </li>
        </ol>
      </li>
    </ul>
  </li>
  <li>
    <p>Select a <strong>Role</strong> to map to the group.</p>
  </li>
  <li>
    <p>Select a <strong>Project/Tenant</strong> to map to the group.</p>

    <p><img src="../images/assign_ldap-roles.png" alt="assign ldap roles"></p>
  </li>
  <li>
    <p>Select any filters to apply to what this group can view in the
<strong>Assign Filters</strong> area:</p>

    <ol>
      <li>
        <p>In the <strong>My Company Tags</strong> tab, select tags to limit the user to
items containing those tags. The items that have changed show in
a blue italicized font.</p>
      </li>
      <li>
        <p>In the <strong>Host &amp; Clusters</strong> tab, select the host and clusters to
limit the user to. The items that have changed show in a blue
italicized font. <img src="../images/2093.png" alt="2093"></p>
      </li>
      <li>
        <p>In the <strong>VMs &amp; Templates</strong> tab, select the folders created in
your virtual infrastructure to limit the user to. The items that
have changed show in a blue italicized font.</p>
      </li>
    </ol>
  </li>
  <li>
    <p>Click <strong>Add</strong>.</p>
  </li>
</ol>

<p>To configure the LDAP group lookup priority, see <a href="#ldap_lookup_priority">Configuring Lookup
Priority for LDAP Groups</a>.</p>

<h3 id="creating-ldap-groups-based-on-manageiq-account-roles">
<a class="anchor" href="#creating-ldap-groups-based-on-manageiq-account-roles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating LDAP Groups Based on ManageIQ Account Roles</h3>

<p>You can also configure access control for LDAP users by creating groups
on your directory server based on ManageIQ user account
roles.</p>

<p>Your LDAP group names must match the account role names in
ManageIQ. The LDAP users in that group are then
automatically assigned to that specific account role.</p>

<p>In your LDAP directory service:</p>

<ol>
  <li>
    <p>Define a distribution group for one or more of the account roles
with the names shown in the table below. This group must be in the
LDAP directory source you specified for the server. See <a href="#ldap_settings">Configuring
LDAP Authentication with IdM and Active Directory</a>.</p>

    <table>
      <thead>
        <tr>
          <th>Directory Service Distribution Group Name</th>
          <th>Account Role</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>EvmGroup-administrator</td>
          <td>Administrator</td>
        </tr>
        <tr>
          <td>EvmGroup-approver</td>
          <td>Approver</td>
        </tr>
        <tr>
          <td>EvmGroup-auditor</td>
          <td>Auditor</td>
        </tr>
        <tr>
          <td>EvmGroup-consumption_administrator</td>
          <td>Consumption Administrator</td>
        </tr>
        <tr>
          <td>EvmGroup-container_administrator</td>
          <td>Container Administrator</td>
        </tr>
        <tr>
          <td>EvmGroup-container_operator</td>
          <td>Container Operator</td>
        </tr>
        <tr>
          <td>EvmGroup-desktop</td>
          <td>Desktop</td>
        </tr>
        <tr>
          <td>EvmGroup-operator</td>
          <td>Operator</td>
        </tr>
        <tr>
          <td>EvmGroup-security</td>
          <td>Security</td>
        </tr>
        <tr>
          <td>EvmGroup-super_administrator</td>
          <td>Super Administrator</td>
        </tr>
        <tr>
          <td>EvmGroup-support</td>
          <td>Support</td>
        </tr>
        <tr>
          <td>EvmRole-tenant_administrator</td>
          <td>Tenant Administrator</td>
        </tr>
        <tr>
          <td>EvmRole-tenant_quota_administrator</td>
          <td>Tenant Quota Administrator</td>
        </tr>
        <tr>
          <td>EvmGroup-user</td>
          <td>User</td>
        </tr>
        <tr>
          <td>EvmGroup-user_limited_self_service</td>
          <td>User Limited Self Service</td>
        </tr>
        <tr>
          <td>EvmGroup-user_self_service</td>
          <td>User Self Service</td>
        </tr>
        <tr>
          <td>EvmGroup-vm_user</td>
          <td>VM User</td>
        </tr>
      </tbody>
    </table>

    <p>Account Role and Directory Service Group Names</p>
  </li>
  <li>
    <p>Assign each user of your directory service that you want to have
access to ManageIQ membership to one of these groups.</p>
  </li>
</ol>

<p>On your ManageIQ appliance:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Click the <strong>Settings</strong> accordion, then select your server under
<strong>Zones</strong>.</p>
  </li>
  <li>
    <p>Click the <strong>Authentication</strong> tab and enable <strong>Get User Groups from
LDAP</strong> after typing in all of the required LDAP authentication
settings. See <a href="#ldap_settings">Configuring LDAP Authentication with IdM and Active
Directory</a>.</p>
  </li>
</ol>

<h2 id="configuring-lookup-priority-for-ldap-groups">
<a class="anchor" href="#configuring-lookup-priority-for-ldap-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Lookup Priority for LDAP Groups</h2>

<p>ManageIQ can have multiple LDAP groups configured, which
the appliance will attempt to authenticate with one by one until it
succeeds. The lookup priority of these groups can be rearranged.</p>

<div class="note">

On initial login, a user’s *current group* assignment is the highest
priority group. User group membership, on subsequent logins, is set as
the last assigned group from the prior session.

</div>

<p>To configure the order in which ManageIQ looks up LDAP
groups:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Click on the <strong>Access Control</strong> accordion, then click <strong>Groups</strong>.</p>
  </li>
  <li>
    <p>Click <img src="../images/1847.png" alt="1847"> (<strong>Configuration</strong>), and <img src="../images/plus_green.png" alt="plus
green"> (<strong>Edit Sequence of User Groups for
LDAP Look Up</strong>) to prioritize which group a user will default to if
LDAP returns multiple matching groups.</p>
  </li>
  <li>
    <p>Select one or more consecutive groups and use the arrow buttons to
move the user group higher or lower in priority.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<h2 id="testing-ldap-configuration">
<a class="anchor" href="#testing-ldap-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing LDAP Configuration</h2>

<p>To test that your LDAP or LDAPS group configuration is working correctly
with ManageIQ:</p>

<ol>
  <li>
    <p>Log out of the ManageIQ user interface.</p>
  </li>
  <li>
    <p>Log back in as an LDAP user that is assigned to one or more of the
matching groups.</p>
  </li>
  <li>
    <p>Change groups by clicking on the user dropdown menu on the top right
of the user interface. The dropdown list will show the groups the
user is authorized for.</p>
  </li>
</ol>

<p>You can also check the logs in <code class="language-plaintext highlighter-rouge">/var/www/miq/vmdb/log/audit.log</code> or
<code class="language-plaintext highlighter-rouge">/var/www/miq/vmdb/log/evm.log</code> to verify your LDAP configuration is
working correctly with the following steps:</p>

<ol>
  <li>
    <p>Run the following command in a terminal to view the log messages in
real time:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>$ tail -f /var/www/miq/vmdb/log/audit.log
</code></pre></div>    </div>
  </li>
  <li>
    <p>Log into the ManageIQ user interface as an LDAP user,
while checking <code class="language-plaintext highlighter-rouge">/var/www/miq/vmdb/log/audit.log</code> for updated status,
success, or failure messages. Alternatively, you can test your LDAP
configuration by viewing the logs in <code class="language-plaintext highlighter-rouge">/var/www/miq/vmdb/log/evm.log</code>
with <code class="language-plaintext highlighter-rouge">grep</code>, which are more verbose.</p>
  </li>
</ol>

<h2 id="troubleshooting-ldap-configuration">
<a class="anchor" href="#troubleshooting-ldap-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Troubleshooting LDAP Configuration</h2>

<p>To test a problematic ManageIQ LDAP configuration, run the
following command to see if the user been pulled from LDAP with the
right group. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ldapsearch -x -H ldap://ldap-example:389 -LLL \ -b "ou=people,dc=example,dc=com" -s sub \ -D "ui=:userid,ou=People,dc=example,dc=com" -w :password \ "(objectclass=organizationalPerson)
</code></pre></div></div>

<p>To test if the user belongs to right group, include one of the following
lines in the <code class="language-plaintext highlighter-rouge">ldapsearch</code> command above:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(&amp;(objectClass=user)(sAMAccountName=yourUserName) (memberof=CN=YourGroup,OU=Users,DC=YourDomain,DC=com))
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-b "ou=groups, dc=example,dc=com"
</code></pre></div></div>

<h1 id="configuring-aws-identity-and-access-management-iam-authentication">
<a class="anchor" href="#configuring-aws-identity-and-access-management-iam-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring AWS Identity and Access Management (IAM) Authentication</h1>

<p>If you choose Amazon AWS Identity and Access Management (IAM) as your
authentication mode, required parameters are exposed under <strong>Amazon
Primary AWS Account Settings for IAM</strong> (Identity and Access Management).
Be sure to validate your settings before saving them.</p>

<div class="note">

For further information on AWS Identity and Access Management settings,
see the [AWS
documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html).

</div>

<p>To configure ManageIQ to use AWS IAM authentication:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Use <strong>Session Timeout</strong> to set the period of inactivity before a
user is logged out of the console.</p>
  </li>
  <li>
    <p>Select <strong>Amazon</strong> as the authentication method in the <strong>Mode</strong> list.</p>
  </li>
  <li>
    <p>Type in an <strong>Access Key</strong> provided by your Amazon account.</p>
  </li>
  <li>
    <p>Type in a <strong>Secret Key</strong> provided by your Amazon account.</p>
  </li>
  <li>
    <p>Optionally, select <strong>Get User Groups from Amazon</strong> to retrieve the
user’s group membership from Amazon. This is used for mapping a
user’s authorization to a ManageIQ role.</p>
  </li>
  <li>
    <p>Click <strong>Validate</strong> to verify your settings.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<p>Users logging into ManageIQ with Amazon authentication
enter their own IAM access key as the username and IAM secret access key
as the password.</p>

<p>Amazon users must be added as a ManageIQ user or belong to
an IAM user group added to the list of ManageIQ groups.</p>

<h1 id="configuring-identity-management-external-authentication-with-manageiq">
<a class="anchor" href="#configuring-identity-management-external-authentication-with-manageiq" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Identity Management (External Authentication) with ManageIQ</h1>

<p>You can configure ManageIQ to use system authentication
methods such as Red Hat Identity Management (IdM) or IPA, Red Hat Single
Sign-On (SSO), or Active Directory (AD).</p>

<p>This method uses <code class="language-plaintext highlighter-rouge">apache</code> (<code class="language-plaintext highlighter-rouge">httpd</code>) modules with web browsers to control
authentication to ManageIQ. It is the recommended
authentication method to connect ManageIQ with most
identity management services.</p>

<h2 id="configuring-authentication-with-ipa">
<a class="anchor" href="#configuring-authentication-with-ipa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Authentication with IPA</h2>

<p>You can configure ManageIQ to use IPA with the <strong>External
Authentication (httpd)</strong> option in ManageIQ.</p>

<p>When external authentication is enabled, users can log in to the
ManageIQ appliance using their IPA server credentials. The
appliance creates user accounts automatically and imports relevant
information from the IPA server.</p>

<p>The appliance contains IPA client software for connecting to IPA
servers, but it is not configured by default. External authentication is
enabled by configuring it with the appliance console and enabling it the
web interface.</p>

<p>Disabling external authentication and returning to internal database
authentication also requires steps in both the appliance console and the
web user interface.</p>

<h3 id="external-authentication-requirements">
<a class="anchor" href="#external-authentication-requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>External Authentication Requirements</h3>

<ul>
  <li>
    <p>For an appliance to leverage an IPA server on the network, both the
appliance and the IPA server must have their clocks synchronized or
Kerberos and LDAP authentication fail.</p>
  </li>
  <li>
    <p>The IPA server must be known by DNS and accessible by name. If DNS
is not configured accordingly, the hosts files need to be updated to
reflect both IPA server and the appliance on both virtual machines.</p>
  </li>
  <li>
    <p>For users to log in to the appliance using IPA server credentials,
they must be members of at least one group on the IPA server which
is also defined in the appliance. Navigate to the settings menu,
then menu:Configuration[Access Control &gt; Groups] to administer
groups.</p>
  </li>
</ul>

<h3 id="configuring-the-appliance-for-external-authentication">
<a class="anchor" href="#configuring-the-appliance-for-external-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring the Appliance for External Authentication</h3>

<p>To configure the appliance for external authentication, set up
authentication using the appliance console, then select the <strong>External
Authentication</strong> option in the web user interface.</p>

<p>Using the appliance console:</p>

<ol>
  <li>
    <p>Log in to the appliance console using the user name <code class="language-plaintext highlighter-rouge">admin</code>.</p>
  </li>
  <li>
    <p>The summary screen displays:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>External Auth:  not configured
</code></pre></div>    </div>
  </li>
  <li>
    <p>Press Enter.</p>
  </li>
  <li>
    <p>Select <strong>Configure External Authentication (httpd)</strong>.</p>
  </li>
  <li>
    <p>Enter the fully qualified host name of the IPA server, for example
<em>ipaserver.test.company.com</em>.</p>
  </li>
  <li>
    <p>Enter the IPA server domain, for example <em>test.company.com</em>.</p>
  </li>
  <li>
    <p>Enter the IPA server realm, for example <em>TEST.COMPANY.COM</em>.</p>
  </li>
  <li>
    <p>Enter the IPA server principal, for example <em>admin</em>.</p>
  </li>
  <li>
    <p>Enter the password of the IPA server principal.</p>
  </li>
  <li>
    <p>Enter <code class="language-plaintext highlighter-rouge">y</code> to proceed.</p>
  </li>
</ol>

<div class="note">

If any of the following conditions are true, configuration fails:

  - The IPA server is not reachable by its FQDN

  - The IPA server cannot reach the appliance by its FQDN

  - The time is not synchronized between the appliance and the IPA
    server

  - The IPA server admin password is entered incorrectly

</div>

<p>Alternatively, you can configure external authentication using the
<code class="language-plaintext highlighter-rouge">appliance_console_cli</code> command instead of using the appliance console
menu:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh root@appliance.test.company.com
[appliance]# /bin/appliance_console_cli --host appliance.test.company.com \
                                      --ipaserver ipaserver.test.company.com \
                                      --iparealm TEST.COMPANY.COM \
                                      --ipaprincipal admin \
                                      --ipapassword smartvm1
</code></pre></div></div>

<p>Finish configuring external authentication using the web user interface:</p>

<ol>
  <li>
    <p>Log in to the web user interface as an administrative user.</p>
  </li>
  <li>
    <p>Navigate to the settings menu, then menu:Configuration[Settings &gt;
Zone &gt; Server &gt; NTP Servers] or use the hosting provider of the
virtual machine to synchronize the appliance’s time with an NTP
server.</p>
  </li>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Select a <strong>Session Timeout</strong> if required.</p>
  </li>
  <li>
    <p>Select <strong>External (httpd)</strong> in the <strong>Mode list</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Enable Single Sign-On</strong> to allow single sign-on using
Kerberos tickets from client machines that authenticate to the same
IPA server as the appliance.</p>
  </li>
  <li>
    <p>In the <strong>Role Settings</strong> area, select <strong>Get User Groups</strong> from
<strong>External Authentication (https)</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<h3 id="reverting-to-internal-database-authentication">
<a class="anchor" href="#reverting-to-internal-database-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reverting to Internal Database Authentication</h3>

<p>To revert to internal database authentication, first configure
authentication using the web user interface, then using the appliance
console.</p>

<p>Using the web user interface:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Select <strong>Database</strong> in the <strong>Mode</strong> list.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<p>Using the appliance console:</p>

<ol>
  <li>
    <p>Log in to the appliance console using the user name <code class="language-plaintext highlighter-rouge">admin</code>.</p>
  </li>
  <li>
    <p>The summary screen displays:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>External Auth:  Id.server.FQDN
</code></pre></div>    </div>
  </li>
  <li>
    <p>Press <code class="language-plaintext highlighter-rouge">Enter</code>.</p>
  </li>
  <li>
    <p>Select <strong>Configure External Authentication (httpd)</strong>. The currently
configured IPA server host name and domain are displayed.</p>
  </li>
  <li>
    <p>Enter <code class="language-plaintext highlighter-rouge">y</code> to remove configuration details for the IPA client.</p>
  </li>
</ol>

<!-- end list -->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh root@appliance.test.company.com
[appliance]# /bin/appliance_console_cli --uninstall-ipa
</code></pre></div></div>

<h3 id="optional-configuration-using-the-appliance-console-cli">
<a class="anchor" href="#optional-configuration-using-the-appliance-console-cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional Configuration Using the Appliance Console CLI</h3>

<p>In addition to using the appliance console, external authentication can
optionally be configured and reverted using the appliance console
command line interface.</p>

<p>Appliance console CLI command and relevant options include:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/appliance_console_cli --host &lt;appliance_fqdn&gt;
                           --ipaserver &lt;ipa_server_fqdn&gt;
                           --iparealm &lt;realm_of_ipa_server&gt;
                           --ipaprincipal &lt;ipa_server_principal&gt;
                           --ipapassword &lt;ipa_server_password&gt;
                           --uninstall-ipa4.5
</code></pre></div></div>

<ul>
  <li>
    <p>--host
Updates the host name of the appliance. If you performed this step
using the console and made the necessary updates made to
<code class="language-plaintext highlighter-rouge">/etc/hosts</code> if DNS is not properly configured, you can omit the
<code class="language-plaintext highlighter-rouge">--host</code> option.</p>
  </li>
  <li>
    <p>--iparealm
If omitted, the <code class="language-plaintext highlighter-rouge">iparealm</code> is based on the domain name of the
<code class="language-plaintext highlighter-rouge">ipaserver</code>.</p>
  </li>
  <li>
    <p>--ipaprincipal
If omitted, defaults to admin.</p>
  </li>
</ul>

<h1 id="configuring-authentication-with-active-directory">
<a class="anchor" href="#configuring-authentication-with-active-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Authentication with Active Directory</h1>

<p>This procedure outlines how to configure ManageIQ to
authenticate against an existing Active Directory (AD) configuration
using external HTTP authentication. This provides Active Directory users
access to the ManageIQ appliance user interface, as well
as the REST API.</p>

<h2 id="connecting-manageiq-to-an-active-directory-domain">
<a class="anchor" href="#connecting-manageiq-to-an-active-directory-domain" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connecting ManageIQ to an Active Directory Domain</h2>

<p>To use an Active Directory domain to authenticate users to
ManageIQ, configure the following on
ManageIQ:</p>

<ol>
  <li>
    <p>Connect to the ManageIQ appliance using SSH.</p>
  </li>
  <li>
    <p>Run <code class="language-plaintext highlighter-rouge">realm discover</code> to determine what Active Directory realms are
available:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># realm discover example.com
  type: kerberos
  realm-name: EXAMPLE.COM
  domain-name: example.com
  configured: kerberos-member
  server-software: active-directory
  client-software: sssd
  required-package: oddjob
  required-package: oddjob-mkhomedir
  required-package: sssd
  required-package: adcli
  required-package: samba-common
  login-formats: %U@example.com
  login-policy: allow-realm-logins
</code></pre></div>    </div>
  </li>
  <li>
    <p>Using the above information for your realm, join the Active
Directory realm with a user that has enough permissions to be able
to browse the directory:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># realm join example.com -U user
Password for user: ******
</code></pre></div>    </div>
  </li>
  <li>
    <p>Allow all realm users to log in using <code class="language-plaintext highlighter-rouge">realm permit</code>:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># realm permit --all
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit the <code class="language-plaintext highlighter-rouge">/etc/sssd/sssd.conf</code> file with your Active Directory
domain details. Refer to the following example for formatting:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>[domain/example.com]
  ad_domain = example.com
  krb5_realm = EXAMPLE.COM
  realmd_tags = manages-system joined-with-samba
  cache_credentials = True
  id_provider = ad
  krb5_store_password_if_offline = True
  default_shell = /bin/bash
  ldap_id_mapping = True
  use_fully_qualified_names = True
  fallback_homedir = /home/%d/%u
  access_provider = ad
 ldap_user_extra_attrs = mail, givenname, sn, displayname, domainname

[sssd]
domains = example.com
config_file_version = 2
services = nss, pam, ifp
default_domain_suffix = example.com

[nss]
homedir_substring = /home

[pam]
default_domain_suffix = example.com

[ifp]
default_domain_suffix = example.com
allowed_uids = apache, root
user_attributes = +mail, +givenname, +sn, +displayname, +domainname
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart and enable the <code class="language-plaintext highlighter-rouge">sssd</code> service:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># systemctl restart sssd
# systemctl enable sssd
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make sure the Kerberos keytab created by <code class="language-plaintext highlighter-rouge">realm join</code> above is
readable by Apache:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># chgrp apache /etc/krb5.keytab
# chmod 640 /etc/krb5.keytab
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copy the following <code class="language-plaintext highlighter-rouge">httpd</code> configuration files into the correct
respective directories with the following commands:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># TEMPLATE_DIR="/opt/rh/cfme-appliance/TEMPLATE"
# cp ${TEMPLATE_DIR}/etc/pam.d/httpd-auth /etc/pam.d/httpd-auth
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user.conf /etc/httpd/conf.d/
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth.conf.erb /etc/httpd/conf.d/manageiq-external-auth.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit the <code class="language-plaintext highlighter-rouge">/etc/httpd/conf.d/manageiq-external-auth.conf</code> file to
point to the Kerberos domain hosted by your Active Directory domain
by adding or editing the lines for <code class="language-plaintext highlighter-rouge">KrbAuthRealms</code>, <code class="language-plaintext highlighter-rouge">Krb5KeyTab</code> and
<code class="language-plaintext highlighter-rouge">KrbServiceName</code> for your environment:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>&lt;Location /dashboard/kerberos_authenticate&gt;
  AuthType           Kerberos
  AuthName           "Kerberos Login"
  KrbMethodNegotiate On
  KrbMethodK5Passwd  Off
  KrbAuthRealms      example.com
  Krb5KeyTab         /etc/krb5.keytab
  KrbServiceName     Any
  Require            pam-account httpd-auth

  ErrorDocument 401  /proxy_pages/invalid_sso_credentials.js
&lt;/Location&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Set the following SELinux booleans:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># setsebool -P allow_httpd_mod_auth_pam on
# setsebool -P httpd_dbus_sssd          on
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart and enable the <code class="language-plaintext highlighter-rouge">httpd</code> service:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># systemctl restart httpd
# systemctl enable httpd
</code></pre></div>    </div>
  </li>
</ol>

<p>Complete authentication setup by configuring the following on each
appliance with the <code class="language-plaintext highlighter-rouge">user_interface</code> or <code class="language-plaintext highlighter-rouge">web_services</code> server roles
enabled.</p>

<p>From the ManageIQ user interface:</p>

<ol>
  <li>
    <p>Log in to the user interface as an administrative user.</p>
  </li>
  <li>
    <p>Navigate to the settings menu, then
menu:Configuration[Authentication].</p>
  </li>
  <li>
    <p>Select a <strong>Session Timeout</strong> if required.</p>
  </li>
  <li>
    <p>Select <strong>External (httpd)</strong> as the authentication <strong>Mode</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Enable Single Sign-On</strong> to allow single sign-on using
Kerberos tickets from client machines that authenticate to the same
Active Directory domain as the appliance.</p>
  </li>
  <li>
    <p>In the <strong>Role Settings</strong> area, select <strong>Get User Groups from
External Authentication (httpd)</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<div class="important">

Make sure the user’s Active Directory groups for the appliance are
created and appropriate roles assigned to those groups. See
[Roles](https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/general_configuration/#roles)
in *General Configuration* for more information.

</div>

<p>ManageIQ is now configured to use authentication from your
Active Directory domain.</p>

<h2 id="mapping-active-directory-users-to-manageiq-user-roles">
<a class="anchor" href="#mapping-active-directory-users-to-manageiq-user-roles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapping Active Directory Users to ManageIQ User Roles</h2>

<p>This section provides instructions for mapping your existing Active
Directory (AD) groups to user account roles in ManageIQ.</p>

<p>This is done by assigning a ManageIQ role to an AD group.
When an AD user who is a part of that AD group attempts to log in to
ManageIQ, they get that role assigned automatically and
inherit the permissions from that role. As a result, all users in that
AD group will then be assigned the ManageIQ role(s)
associated with that group.</p>

<p>After configuring ManageIQ to connect to an Active
Directory domain in <a href="#connecting_to_AD_domain">Connecting ManageIQ to an Active
Directory Domain</a>, complete the following
steps:</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Click the <strong>Access Control</strong> accordion, then click <strong>Groups</strong>.</p>
  </li>
  <li>
    <p>Click <img src="../images/1847.png" alt="1847"> (<strong>Configuration</strong>), and <img src="../images/plus_green.png" alt="plus
green"> (<strong>Add a new Group</strong>) to create a
group.</p>
  </li>
  <li>
    <p>In <strong>Group Information</strong>, select <strong>Look Up External Authentication
Groups</strong> to find a list of groups assigned to a specific user in
Active Directory.</p>
  </li>
  <li>
    <p>In <strong>User to Look Up</strong>, enter the user name for a user in your AD
group.</p>

    <p><img src="../images/ad-userlookup.png" alt="ad userlookup"></p>
  </li>
  <li>
    <p>Click <strong>Retrieve</strong> to look up details for the user in Active
Directory and pull group information for the user. As a result, the
AD groups will appear in the <strong>LDAP Groups for User</strong> drop-down
list.</p>
  </li>
  <li>
    <p>From the list in <strong>LDAP Groups for User</strong>, select the group you want
to associate a ManageIQ role with; for example, the
<code class="language-plaintext highlighter-rouge">cloudforms</code> group.</p>

    <p><img src="../images/assign_ad-roles.png" alt="assign ad roles"></p>
  </li>
  <li>
    <p>Select a <strong>Role</strong> to map to the group.</p>
  </li>
  <li>
    <p>Select a <strong>Project/Tenant</strong> to map to the group.</p>
  </li>
  <li>
    <p>Click <strong>Add</strong>.</p>
  </li>
</ol>

<p>Any user who is part of <code class="language-plaintext highlighter-rouge">cloudforms</code> AD group can now log in to
ManageIQ with their AD username and password, and they
will automatically inherit the permissions for the role you assigned
earlier.</p>

<p>To confirm this is configured correctly, log in to the
ManageIQ user interface with a user in the <code class="language-plaintext highlighter-rouge">cloudforms</code> AD
group.</p>

<p>To grant an additional user access to the ManageIQ server,
create the user in Active Directory, then add that user to the
<code class="language-plaintext highlighter-rouge">cloudforms</code> AD group. When that user attempts to log in to
ManageIQ, they will automatically inherit the correct
permissions for the group.</p>

<h1 id="configuring-federated-authentication-with-saml">
<a class="anchor" href="#configuring-federated-authentication-with-saml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Federated Authentication with SAML</h1>

<p>This procedure outlines how to manually configure an appliance to use
SAML for federation authentication.</p>

<p>To enable external authentication using SAML, complete the following
steps to configure your HTTP server, then your ManageIQ
appliance.</p>

<div class="note">

The current SAML implementation only secures the ManageIQ
appliance’s web user interface with SAML. The REST API and self service
user interface do not currently support SAML.

</div>

<p><strong>SAML Requirements.</strong></p>

<p>The following is required in order to enable SAML authentication to the
appliance:</p>

<ul>
  <li>
    <p>A ManageIQ appliance</p>
  </li>
  <li>
    <p>A SAML identity provider (e.g. Red Hat Single Sign-On 7.0 or later)</p>
  </li>
</ul>

<h2 id="configuring-authentication-with-saml-and-red-hat-single-sign-on-rh-sso">
<a class="anchor" href="#configuring-authentication-with-saml-and-red-hat-single-sign-on-rh-sso" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Authentication with SAML and Red Hat Single Sign-On (RH-SSO)</h2>

<p>While other SAML identity providers can be used with
ManageIQ, this example procedure covers using Red Hat
Single Sign-On (RH-SSO) 7.0, which is implemented using the Apache HTTP
server’s <code class="language-plaintext highlighter-rouge">mod_auth_mellon</code> module.</p>

<div class="note">

For more information about Red Hat Single Sign-On (RH-SSO), see the [Red
Hat Single Sign-On
documentation](https://access.redhat.com/products/red-hat-single-sign-on).

</div>

<h3 id="configuring-the-http-server-for-saml-authentication-with-red-hat-single-sign-on-rh-sso">
<a class="anchor" href="#configuring-the-http-server-for-saml-authentication-with-red-hat-single-sign-on-rh-sso" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring the HTTP Server for SAML Authentication with Red Hat Single Sign-On (RH-SSO)</h3>

<p>The Apache HTTP server first must be configured to work with SAML
authentication. All SAML-related certificates and keys are accessed from
<code class="language-plaintext highlighter-rouge">/etc/httpd/saml2/</code>.</p>

<ol>
  <li>
    <p>Log into the ManageIQ appliance as root using SSH, and
create the <code class="language-plaintext highlighter-rouge">/etc/httpd/saml2/</code> directory:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># mkdir -p /etc/httpd/saml2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copy the <code class="language-plaintext highlighter-rouge">httpd</code> remote user and SAML template configuration files
to the appliance:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># TEMPLATE_DIR="/opt/rh/cfme-appliance/TEMPLATE"
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user.conf /etc/httpd/conf.d/
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth-saml.conf /etc/httpd/conf.d/
</code></pre></div>    </div>

    <div class="note">

The following are notable SAML configuration defaults in the
`manageiq-external-auth-saml.conf` file:

  - Identity Provider Files (i.e. Red Hat SSO)

      - Metadata File: `/etc/httpd/saml2/idp-metadata.xml`

  - Service Provider Files (i.e. `mod_auth_mellon`)

      - Private Key File: `/etc/httpd/saml2/miqsp-key.key`

      - Certificate File: `/etc/httpd/saml2/miqsp-cert.cert`

      - Metadata File: `/etc/httpd/saml2/miqsp-metadata.xml`

Other `mod_auth_mellon` parameters, such as endpoints and protected
URLs, must not be modified as the appliance expects them to be
defined as such.

</div>
  </li>
  <li>
    <p>Generate the service provider files on the appliance using the
Apache HTTP server’s <code class="language-plaintext highlighter-rouge">mod_auth_mellon</code> command
<code class="language-plaintext highlighter-rouge">mellon_create_metadata.sh</code>:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># cd /etc/httpd/saml2
# /usr/libexec/mod_auth_mellon/mellon_create_metadata.sh https://&lt;miq-appliance&gt; https://&lt;miq-appliance&gt;/saml2
</code></pre></div>    </div>

    <p>The <code class="language-plaintext highlighter-rouge">mellon_create_metadata.sh</code> script creates file names based on
the appliance URL.</p>

    <div class="note">

If your appliance is behind a load balancer or uses a virtual IP
address, use the hostname associated with the VIP. For example: `#
/usr/libexec/mod_auth_mellon/mellon_create_metadata.sh
https://my-haproxy-ka https://my-haproxy-ka/saml2`

</div>
  </li>
  <li>
    <p>Rename the files created by the <code class="language-plaintext highlighter-rouge">mellon_create_metadata.sh</code> script
to match the expected file names from the
<code class="language-plaintext highlighter-rouge">manageiq-external-auth-saml.conf</code> file:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># mv https_&lt;miq-appliance&gt;.key  miqsp-key.key
# mv https_&lt;miq-appliance&gt;.cert miqsp-cert.cert
# mv https_&lt;miq-appliance&gt;.xml  miqsp-metadata.xml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Now that the service provider’s <code class="language-plaintext highlighter-rouge">metadata.xml</code> file has been
generated, the service provider definition can be defined in the
SAML identity provider. For Red Hat SSO, a realm can be created for
one or more appliances with individual clients defined one per
appliance, where the client ID is specified as the URL of the
appliance.</p>

    <p>To add a client in the Red Hat SSO ManageIQ realm:</p>

    <ol>
      <li>
        <p>Select and import the <code class="language-plaintext highlighter-rouge">miqsp-metadata.xml</code> file created for
<code class="language-plaintext highlighter-rouge">mod_auth_mellon</code>.</p>
      </li>
      <li>
        <p>Set the client ID as <code class="language-plaintext highlighter-rouge">https://&lt;miq-appliance&amp;gt;</code>.</p>
      </li>
      <li>
        <p>Set the client protocol as <code class="language-plaintext highlighter-rouge">saml</code>.</p>
      </li>
    </ol>
  </li>
  <li>
    <p>Update the client definition for the appliance in Red Hat SSO with
the following:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Name ID Format</td>
          <td>username</td>
        </tr>
        <tr>
          <td>Valid Redirect URIs</td>
          <td>
<a href="https://&lt;miq-appliance">https://&lt;miq-appliance</a>/saml2/postResponse&gt;</td>
        </tr>
        <tr>
          <td>Assertion Consumer Service POST Binding URL</td>
          <td>
<a href="https://&lt;miq-appliance">https://&lt;miq-appliance</a>/saml2/postResponse&gt;</td>
        </tr>
        <tr>
          <td>Logout Service Redirect Binding URL</td>
          <td>
<a href="https://&lt;miq-appliance">https://&lt;miq-appliance</a>/saml2/logout&gt;</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Obtain the identity provider’s <code class="language-plaintext highlighter-rouge">idp-metadata.xml</code> metadata file as
follows:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># cd /etc/httpd/saml2
# curl -s -o idp-metadata.xml \
  http://&lt;redhatSSO-server&gt;:8080/auth/realms/&lt;miq-realm&gt;/protocol/saml/descriptor
</code></pre></div>    </div>
  </li>
  <li>
    <p>In ManageIQ, the following change is necessary to the
<code class="language-plaintext highlighter-rouge">idp-metadata.xml</code> file for SAML logout to work between
<code class="language-plaintext highlighter-rouge">mod_auth_mellon</code> and Red Hat SSO:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># vi idp-metadata.xml

  ...
  &lt;SingleLogoutService
&lt;   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
---
&gt;   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
    Location=
  ...
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart the HTTP server on the appliance:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code># systemctl restart httpd
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="configuring-saml-authentication-in-the-manageiq-user-interface">
<a class="anchor" href="#configuring-saml-authentication-in-the-manageiq-user-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring SAML Authentication in the ManageIQ User Interface</h3>

<p>After configuring the HTTP server for SAML, update the
ManageIQ appliance so that user interface can be accessed
using SAML authentication.</p>

<ol>
  <li>
    <p>Click <img src="../images/config-gear.png" alt="config gear"> (<strong>Configuration</strong>).</p>
  </li>
  <li>
    <p>Select your server in the <strong>Settings</strong> accordion.</p>
  </li>
  <li>
    <p>Select the <strong>Authentication</strong> tab.</p>
  </li>
  <li>
    <p>Select a <strong>Session Timeout</strong> to set the period of inactivity before
a user is logged out of the console.</p>
  </li>
  <li>
    <p>Set the mode to <strong>External (httpd)</strong>.</p>
  </li>
  <li>
    <p>Check <strong>Enable SAML</strong>. This enables the SAML login button on the
appliance login screen, then redirects to the SAML protected page
for authentication, and supports the SAML logout process.</p>
  </li>
  <li>
    <p>Check <strong>Enable Single Sign-On</strong>. With this option enabled, initial
access to the appliance’s user interface redirects to the SAML
identity provider authentication screen. Logging out from the
appliance returns the user to the appliance login screen, allowing
them to log in as <code class="language-plaintext highlighter-rouge">admin</code> unless <strong>Disable Local Login</strong> is also
checked.</p>
  </li>
  <li>
    <p>Optional: Check <strong>Disable Local Login</strong> to disable the <code class="language-plaintext highlighter-rouge">admin</code> login
to appliance and only allow SAML based authentication. Note that if
there are issues with the identity provider or you require <code class="language-plaintext highlighter-rouge">admin</code>
access to the appliance, you cannot log in through the appliance
login screen until you re-enable local login as described in
<a href="#re-enable-local-login">Re-enabling Local Login </a>.</p>
  </li>
  <li>
    <p>Check <strong>Get User Groups from External Authentication (httpd)</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<div class="important">

Ensure the user’s groups are created on the appliance and appropriate
roles are assigned to those groups. See *SAML Assertions* in [SAML
Assertions](#saml-assertions) for more information on the parameters
used by the ManageIQ appliance.

For example, to configure user groups from your SAML identity provider
to work with ManageIQ:

1.  In your SAML identity provider, specify your existing user groups in
    similar format to the following:
    `REMOTE_USER_GROUPS=Administrators;CloudAdministrators;Users`

2.  On your ManageIQ appliance, create the equivalent
    groups. See [Creating a User
    Group](https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/general_configuration/#creating-a-user-group)
    in *General Configuration*.

3.  On your ManageIQ appliance, assign EVM roles to the
    groups. See [Creating a
    Role](https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/general_configuration/#creating-a-role)
    in *General Configuration*.

</div>

<p>Complete the above steps on each appliance in the settings menu, then
navigate to menu:Configuration[Access Control].</p>

<p>You can now log into your ManageIQ appliance using your
SAML credentials.</p>

<h2 id="saml-assertions">
<a class="anchor" href="#saml-assertions" aria-hidden="true"><span class="octicon octicon-link"></span></a>SAML Assertions</h2>

<p>To authenticate to the ManageIQ appliance using SAML, the
following remote user parameters are looked at by the appliance upon a
successful login and redirect from the identity provider. These
parameters are used by the appliance to obtain group authentication
information.</p>

<table>
  <thead>
    <tr>
      <th>HTTP Environment</th>
      <th>SAML Assertion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>REMOTE_USER</td>
      <td>username</td>
    </tr>
    <tr>
      <td>REMOTE_USER_EMAIL</td>
      <td>email</td>
    </tr>
    <tr>
      <td>REMOTE_USER_FIRSTNAME</td>
      <td>firstname</td>
    </tr>
    <tr>
      <td>REMOTE_USER_LASTNAME</td>
      <td>lastname</td>
    </tr>
    <tr>
      <td>REMOTE_USER_FULLNAME</td>
      <td>fullname</td>
    </tr>
    <tr>
      <td>REMOTE_USER_GROUPS</td>
      <td>groups</td>
    </tr>
  </tbody>
</table>

<p>For Red Hat SSO, the above SAML assertions can be defined for the
appliance client in Red Hat SSO as mappers.</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>Type</th>
      <th>Property</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>username</td>
      <td>AttributeStatement Mapper</td>
      <td>User Property</td>
      <td>username</td>
    </tr>
    <tr>
      <td>email</td>
      <td>AttributeStatement Mapper</td>
      <td>User Property</td>
      <td>email</td>
    </tr>
    <tr>
      <td>firstname</td>
      <td>AttributeStatement Mapper</td>
      <td>User Property</td>
      <td>firstName</td>
    </tr>
    <tr>
      <td>lastname</td>
      <td>AttributeStatement Mapper</td>
      <td>User Property</td>
      <td>lastName</td>
    </tr>
    <tr>
      <td>fullname</td>
      <td>AttributeStatement Mapper</td>
      <td>User Attribute</td>
      <td>fullName</td>
    </tr>
    <tr>
      <td>groups</td>
      <td>Group Mapper</td>
      <td>Group List</td>
      <td>groups</td>
    </tr>
  </tbody>
</table>

<div class="important">

The `fullName` attribute was not available in the default database as of
this writing and was added as a user attribute.

</div>

<h2 id="re-enabling-local-login-optional">
<a class="anchor" href="#re-enabling-local-login-optional" aria-hidden="true"><span class="octicon octicon-link"></span></a>Re-enabling Local Login <em>(Optional)</em>
</h2>

<p>If you disabled local login in the ManageIQ user interface
but need the ability to log in as <code class="language-plaintext highlighter-rouge">admin</code>, you can re-enable local login
using one of the following methods:</p>

<p><strong>Re-enabling Local Login from the Appliance User Interface.</strong></p>

<p>This method requires the identity provider to be available, and the
ability to log in as a user with enough administrative privileges to
update ManageIQ authentication settings.</p>

<ol>
  <li>
    <p>Log in to the appliance user interface as the administrative user.</p>
  </li>
  <li>
    <p>From the settings menu, select menu:Configuration[Authentication].</p>
  </li>
  <li>
    <p>Uncheck <strong>Disable Local Login</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
</ol>

<!-- end list -->

<ol>
  <li>
    <p>Use SSH to log into the appliance as <code class="language-plaintext highlighter-rouge">root</code>.</p>
  </li>
  <li>
    <p>Run the <code class="language-plaintext highlighter-rouge">appliance_console</code> command.</p>
  </li>
  <li>
    <p>Select <strong>Update External Authentication Options</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Enable Local Login</strong>.</p>
  </li>
  <li>
    <p>Apply the updates.</p>
  </li>
</ol>

<p>Alternatively, log into the appliance as root using SSH, and run the
following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># appliance_console_cli --extauth-opts local_login_disabled=false
</code></pre></div></div>

<h1 id="troubleshooting-external-authentication-configuration">
<a class="anchor" href="#troubleshooting-external-authentication-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Troubleshooting External Authentication Configuration</h1>

<p>The following are common errors that you may encounter when integrating
with IPA:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error -1 : Kerberos authentication failed: kinit: Cannot contact any KDC for realm
</code></pre></div></div>

<p><strong>Resolution:</strong> Verify on IPA server if you are able to log into the IPA
server using same user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error-2: [----] W, [2017-09-28T10:05:29.157980 #28902:fa8bc4] WARN -- Failure: MIQ(Authenticator.authenticate) userid: [jdoe] - Authentication failed for userid jdoe: Authentication token is no longer valid; new one required
</code></pre></div></div>

<p><strong>Resolution:</strong> The password has expired. Go to IPA/LDAP server and
update your password using <code class="language-plaintext highlighter-rouge">kinit &lt;username&gt;</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error-3: [----] W, [2017-09-28T10:13:10.083614 #28902:fa8bc4] WARN -- Failure: MIQ(Authenticator.block in authorize) userid: [jdoe] - Authentication failed for userid jdoe, unable to match user's group membership to an EVM role
</code></pre></div></div>

<p><strong>Resolution:</strong> You should add the same group to the
ManageIQ group. Make sure you select <strong>Look up External
Authentication Groups</strong> and enter the group name and user to look up.</p>

<h2 id="additional-troubleshooting-tips">
<a class="anchor" href="#additional-troubleshooting-tips" aria-hidden="true"><span class="octicon octicon-link"></span></a>Additional Troubleshooting Tips</h2>

<ul>
  <li>
    <p>Make an IPA/LDAP host entry in <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file on the
ManageIQ appliance.</p>
  </li>
  <li>
    <p>Make sure NTP synchronization exists between the
ManageIQ appliance and the IPA server.</p>
  </li>
  <li>
    <p>Check <code class="language-plaintext highlighter-rouge">/var/log/krb5kdc.log</code> on the IPA server end and
<code class="language-plaintext highlighter-rouge">/var/www/miq/vmdb/log/audit.log</code> on the ManageIQ
appliance end for any other exception.</p>
  </li>
</ul>



      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
      
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2020 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58883457-1', 'auto');
  ga('send', 'pageview');

</script>
    
  </body>
</html>
