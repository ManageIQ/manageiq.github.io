<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />
  
  <link type="text/css" rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://manageiq.org/docs/guides/proposals/configuration_redesign">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/guides/proposals/configuration_redesign">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li>
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li class="active">
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

</nav>

<div class="doc_container">
  <div class="doc_menu">
    
    

<ul class="menu menu-toplevel" id="guides_menu">

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Architecture
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/capacity_and_utilization_collection_explanation">
      Capacity And Utilization Collection Explanation
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/enterprise">
      Enterprise
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/source_code_layout">
      Source Code Layout
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Developer Setup
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/plugins">
      Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/minimal_mode">
      Minimal Mode
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/running_test_suites">
      Running Test Suites
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/debugging">
      Interactive debugging
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      External Auth
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/configuration">
      Configuration
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/installation">
      Installation
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      User Interface
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/patterns">
      UI Patterns
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/plugins">
      UI Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/register_react_component">
      Shared React Component API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/report_data_api">
      Report Data API
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Providers
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_overview">
      Providers Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_database_architecture.html">
      Providers Database Architecture
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/amazon_aws_config">
      Amazon AWS Config
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/containers">
      Containers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/openshift">
      Openshift
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/openstack_infra_provider">
      Openstack Infra Provider
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/provisioning/windows_imaging">
      Windows Imaging
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/coding_style_and_standards">
      Coding Style And Standards
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/i18n">
      I18n
    </a>
    
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc dev_doc">
      

      <div class="doc-content">
        
        <h1 id="configuration-redesign">Configuration Redesign</h1>

<p>As a User, I want to be able to set configuration settings for multiple servers at once at any scoping level (Region, Zone, etc).</p>

<p>As a Developer, I want to be able to access any server’s configuration from code in a performant way.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>Scopes: template, enterprise, region, zone, server, development</li>
  <li>Get/set configurations for any server at any level</li>
  <li>Support multiple configuration files (vmdb, event_handling, etc.)</li>
</ul>

<h3 id="ui">UI</h3>
<ul>
  <li>Currently gets the configurations, work with it as a hash, and is able to save or reset.</li>
  <li>Remove advanced settings as YAML modifications directly and replace (tree?)</li>
</ul>

<h3 id="addremovesupdates-by-dev">Add/Removes/Updates by dev</h3>
<ul>
  <li>New keys can be added to the template by dev and should just be included.</li>
  <li>Deletes in templates should possibly cleanup deltas from other scopes (maybe not for hidden keys)(may force a data migration)</li>
  <li>Key moves must be handled with a data migration</li>
  <li>Template value updates may require notification if the user has changed their value also (do or do not force our key value changes)</li>
</ul>

<h3 id="other">Other</h3>
<ul>
  <li>Remove primordial settings (settings needed before database access, like log settings) from vmdb.yml and create a new .yml file.</li>
  <li>Support typing of values (String vs. Integer, password fields, etc.)</li>
  <li>Provide a way to revert back to template/default</li>
  <li>Migrate changes from existing configurations table.</li>
  <li>Special cases: database.yml, other primordial stuff like log settings</li>
</ul>

<h2 id="implementation">Implementation</h2>

<p>configurations table will store deltas from the template.</p>

<table>
  <thead>
    <tr>
      <th>Column</th>
      <th>Type</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>file</td>
      <td>string</td>
      <td>vmdb, event_handling, etc. (pick a better name)</td>
    </tr>
    <tr>
      <td>key</td>
      <td>string</td>
      <td>a URI like string representing the nesting. e.g. /workers/worker_base/ui_worker/count</td>
    </tr>
    <tr>
      <td>value</td>
      <td>text</td>
      <td>text serializes allowing storing of type as well as complex values</td>
    </tr>
    <tr>
      <td>scope</td>
      <td>string</td>
      <td>enterprise, region, zone, server, development (template scope is not stored in the database)</td>
    </tr>
    <tr>
      <td>created_at</td>
      <td>timestamp</td>
      <td> </td>
    </tr>
    <tr>
      <td>updated_at</td>
      <td>timestamp</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">Vmdb::Config</code> class, when loading a particular configuration will load the template from the file system, then apply delta rows in scope order.  All region deltas, then all zone deltas, etc.  Final result is cached as the singleton.</p>

<ul>
  <li>When a user makes a change, we add a delta row.</li>
  <li>When a user chooses reset to default, we remove the delta row.</li>
  <li>When a user makes a change on an existing delta, even if the change matches the current default from the template, keep the delta in the table so their changes will remain even if our default changes.  This allows consciously making the choice of a value, versus making the choice to use the default.</li>
</ul>

<p>When a change is saved to the configuration, invalidate the local cache, and notify
  all servers via the queue that they should invalidate their caches as well.</p>

<p>The api should provide singleton methods to access the cached copy at different scopes for each file</p>
<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Vmdb</span><span class="o">::</span><span class="no">Config</span><span class="p">[</span><span class="s2">"vmdb"</span><span class="p">]</span> <span class="c1"># default is my_server level</span>
<span class="no">Vmdb</span><span class="o">::</span><span class="no">Config</span><span class="p">[</span><span class="s2">"vmdb"</span><span class="p">,</span> <span class="ss">:region</span><span class="p">]</span>
</code></pre>
</div>

<p>Callers currently treat the config like a set of nested hashes, so we may want expose the same interface.  fetch_path (an evm Hash extension) is used extensively in caller code as well.</p>

<h2 id="ui--ux">UI / UX</h2>

<p>Currently we have specialized screens for modifying certain configuration options.  Beyond that we have the Advanced Settings page which allows the user to modify the config YAML file directly.  However, this is problematic for a number of reasons, both with usability and data integrity.</p>

<p>One possible solution in the new redesign is to present the data as an editable grid or a tree structure.</p>

<h3 id="grid">Grid</h3>
<ul>
  <li>Each row would show each individual value, and afterward could be a text box and/or a “reset to default” button</li>
  <li>The key, default value and current value would no be modifiable.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Default Value</th>
      <th>Current Value</th>
      <th>New Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/performance/history/initial_capture_days</td>
      <td>0</td>
      <td><code class="highlighter-rouge">&lt;default&gt;</code></td>
      <td><code class="highlighter-rouge">[_____] (Reset to Default)</code></td>
    </tr>
    <tr>
      <td>/performance/history/keep_daily_performances</td>
      <td>6.months</td>
      <td>6.months</td>
      <td><code class="highlighter-rouge">[_____] (Reset to Default)</code></td>
    </tr>
    <tr>
      <td>/performance/history/keep_hourly_performances</td>
      <td>6.months</td>
      <td>3.months</td>
      <td><code class="highlighter-rouge">[_____] (Reset to Default)</code></td>
    </tr>
    <tr>
      <td>/performance/history/keep_realtime_performances</td>
      <td>4.hours</td>
      <td><code class="highlighter-rouge">&lt;default&gt;</code></td>
      <td><code class="highlighter-rouge">[_____] (Reset to Default)</code></td>
    </tr>
  </tbody>
</table>

<h3 id="tree">Tree</h3>
<ul>
  <li>Present each value in a tree structure, at the end of which is a text box and/or a “reset to default” button</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>- performance
  - history
    - initial_capture_days
      - Default Value: "0", Current Value: `&lt;default&gt;`  New Value: `[_____] (Reset to Default)`
    - keep_daily_performances
      - Default Value: "6.months", Current Value: "6.months"  New Value: `[_____] (Reset to Default)`
    - keep_hourly_performances
      - Default Value: "6.months", Current Value: "3.months"  New Value: `[_____] (Reset to Default)`
    - keep_realtime_performances
      - Default Value: "4.hours", Current Value: `&lt;default&gt;`  New Value: `[_____] (Reset to Default)`
</code></pre>
</div>

      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2019 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://plus.google.com/+ManageiqOrg" class="social_link social_link-google_plus">
            <span class="social_link-icon">
              <i class="fa fa-google-plus"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
  </body>
</html>
