<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />

  <script>
    stored_theme = localStorage.getItem('miq-theme');
    theme        = stored_theme && JSON.parse(localStorage.getItem('miq-theme'));

    if (theme === "light-theme") {
      document.querySelector('html').classList.add("light-theme");
    }

    if (theme === "dark-theme") {
      document.querySelector('html').classList.add("dark-theme");
    }
  </script>

  <link type="text/css" rel="stylesheet" href="/assets/main-364a522e6cb5aa31700d9562491465966c2c1081a61b11529597f13bf81cfb69.css">
  <link rel="canonical" href="http://manageiq.org/docs/guides/providers/subclassing_an_existing_provider">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/guides/providers/subclassing_an_existing_provider">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li>
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li class="active">
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

    <div class="col-lg-4 col-md-4 col-sm-12 pull-right" style="margin-top: 10px">
        <script async src="https://cse.google.com/cse.js?cx=006042792541147862616:dfkijfebdts"></script>
         <div class="gcse-search"></div>
    </div>
</nav>

<script>
  window.onload = demo;
	function demo() {
	    document.getElementById("gsc-i-id1").setAttribute("placeholder", "Search Documentation")
	}
</script>

<div class="doc_container">
  <div class="doc_menu">
    
    

<ul class="menu menu-toplevel" id="guides_menu">

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Architecture
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/capacity_and_utilization_collection_explanation.html">
      Capacity And Utilization Collection Explanation
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/enterprise.html">
      Enterprise
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/source_code_layout.html">
      Source Code Layout
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Developer Setup
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/plugins.html">
      Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/running_test_suites.html">
      Running Test Suites
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/debugging.html">
      Interactive debugging
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      External Auth
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/configuration.html">
      Configuration
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/installation.html">
      Installation
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      User Interface
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/patterns.html">
      UI Patterns
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/plugins.html">
      UI Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/register_react_component.html">
      Shared React Component API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/report_data_api.html">
      Report Data API
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Providers
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_overview.html">
      Providers Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_database_architecture.html">
      Providers Database Architecture
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/amazon_aws_config.html">
      Amazon AWS Config
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/containers.html">
      Containers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/openshift.html">
      Openshift
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/openstack_infra_provider.html">
      Openstack Infra Provider
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/provisioning/windows_imaging.html">
      Windows Imaging
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/coding_style_and_standards.html">
      Coding Style And Standards
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/i18n.html">
      I18n
    </a>
    
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc dev_doc">
      

      <div class="doc-content">
        
        <h2 id="subclassing-an-existing-provider">Subclassing an existing provider</h2>

<p>We have already covered creating a new provider from scratch in <a href="writing_a_new_provider">Creating a new provider</a>, however it is also common for a provider to use the API from another.  For example there are a number of Cloud Services which host Kubernetes and expose the standard k8s API with different authentication.  The Openstack API is also an industry standard for private clouds and is widely implemented by other providers.</p>

<p>In the case where the existing provider API is already a part of ManageIQ it is possible to “subclass” the existing provider plugin and only implement the differences or possibly just provide a more specific name and logo that users will recognize.</p>

<p>For our example here we are going to add an on-premise version of our existing AwesomeCloud from <a href="writing_a_new_provider">Creating a new provider</a>, called AwesomePrivateCloud.  This is going to have an OpenStack compatible API but we are going to make some minor changes to the available options, taking advantage of the fact that we have a specific provider plugin.</p>

<h3 id="creating-the-new-plugin">Creating the new plugin</h3>

<p>First step is to create a new empty plugin:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>rails generate manageiq:provider ManageIQ::Providers::AwesomePrivateCloud <span class="nt">--no-scaffolding</span> <span class="nt">--vcr</span>
<span class="k">**</span> ManageIQ master, codename: Oparin
      create  
         run  git init /home/grare/adam/src/manageiq/manageiq/plugins/manageiq-providers-awesome_private_cloud from <span class="s2">"."</span>

Initialized empty Git repository <span class="k">in</span> /home/grare/adam/src/manageiq/manageiq/plugins/manageiq-providers-awesome_private_cloud/.git/
      create  manageiq-providers-awesome_private_cloud.gemspec
      create  .codeclimate.yml
      create  .gitignore
      create  .rspec
      create  .rspec_ci
      create  .rubocop.yml
      create  .rubocop_cc.yml
      create  .rubocop_local.yml
      create  .whitesource
      create  .yamllint
      create  Gemfile
      create  LICENSE.txt
      create  Rakefile
      create  README.md
      create  bin/ci/after_script
      create  bin/rails
      create  bin/setup
      create  bin/update
      create  bundler.d
      create  bundler.d/.keep
      create  config/secrets.defaults.yml
      create  config/settings.yml
      create  lib/manageiq-providers-awesome_private_cloud.rb
      create  lib/manageiq/providers/awesome_private_cloud/engine.rb
      create  lib/manageiq/providers/awesome_private_cloud/version.rb
      create  lib/tasks/README.md
      create  lib/tasks_private/spec.rake
      create  locale
      create  locale/.keep
      create  spec/factories
      create  spec/support
      create  spec/spec_helper.rb
      insert  /home/grare/adam/src/manageiq/manageiq/Gemfile
      create  spec/models/manageiq/providers/awesome_private_cloud
        gsub  lib/tasks_private/spec.rake
      insert  .yamllint
      append  spec/spec_helper.rb

</code></pre></div></div>

<p>Follow the steps from <a href="writing_a_new_provider">Creating a new provider</a> for setting up your new plugin for local development by adding to your <code class="language-plaintext highlighter-rouge">bundler.d/override.rb</code> and symlinking your <code class="language-plaintext highlighter-rouge">spec/manageiq</code> directory.</p>

<p>You’ll notice however that we chose “–no-scaffolding” option, this is going to allow us to define the classes that we need as subclasses of the OpenStack provider.</p>

<h3 id="creating-the-subclasses">Creating the subclasses</h3>

<p>Now that we have an empty plugin we have to start adding the subclasses that we need for the provider to work.</p>

<p>First let’s create the initial directories that will hold our subclasses:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> app/models/manageiq/providers/awesome_private_cloud/<span class="o">{</span>cloud_manager,network_manager,storage_manager<span class="o">}</span> app/models/manageiq/providers/awesome_private_cloud/inventory/<span class="o">{</span>collector,parser,persister<span class="o">}</span>
</code></pre></div></div>

<p>Now we can start defining our main manager class that will inherit from OpenStack:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">Openstack</span><span class="o">::</span><span class="no">CloudManager</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">ActsAsStiLeafClass</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ManageIQ::Providers::AwesomePrivateCloud::CloudManager</span> <span class="o">&lt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">Openstack</span><span class="o">::</span><span class="no">CloudManager</span>
  <span class="n">require_nested</span> <span class="ss">:RefreshWorker</span>

  <span class="n">supports</span> <span class="ss">:create</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">vm_vendor</span>
    <span class="s2">"awesome_private_cloud"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">ems_type</span>
    <span class="vi">@ems_type</span> <span class="o">||=</span> <span class="s2">"awesome_private_cloud"</span><span class="p">.</span><span class="nf">freeze</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">description</span>
    <span class="vi">@description</span> <span class="o">||=</span> <span class="s2">"Awesome Private Cloud"</span><span class="p">.</span><span class="nf">freeze</span>
  <span class="k">end</span>

  <span class="n">has_one</span> <span class="ss">:network_manager</span><span class="p">,</span>
          <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="ss">:parent_ems_id</span><span class="p">,</span>
          <span class="ss">:class_name</span>  <span class="o">=&gt;</span> <span class="s2">"ManageIQ::Providers::AwesomePrivateCloud::NetworkManager"</span><span class="p">,</span>
          <span class="ss">:autosave</span>    <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
          <span class="ss">:dependent</span>   <span class="o">=&gt;</span> <span class="ss">:destroy</span>
  <span class="n">has_one</span> <span class="ss">:cinder_manager</span><span class="p">,</span>
          <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="ss">:parent_ems_id</span><span class="p">,</span>
          <span class="ss">:class_name</span>  <span class="o">=&gt;</span> <span class="s2">"ManageIQ::Providers::AwesomePrivateCloud::StorageManager::CinderManager"</span><span class="p">,</span>
          <span class="ss">:dependent</span>   <span class="o">=&gt;</span> <span class="ss">:destroy</span><span class="p">,</span>
          <span class="ss">:inverse_of</span>  <span class="o">=&gt;</span> <span class="ss">:parent_manager</span><span class="p">,</span>
          <span class="ss">:autosave</span>    <span class="o">=&gt;</span> <span class="kp">true</span>

  <span class="k">def</span> <span class="nf">image_name</span>
    <span class="s2">"awesome_private_cloud"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">ensure_swift_manager</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This introduces the concept of <code class="language-plaintext highlighter-rouge">ActsAsStiLeafClass</code> which is critical to how a subclassed provider works.  If you don’t already understand how Single-Table Inheritance (STI) works, here is a quick primer.</p>

<h3 id="single-table-inheritance-and-actsasstileafclass">Single-Table Inheritance and ActsAsStiLeafClass</h3>

<p>STI allows for class hierarchies to be persisted to the database by way of storing the class name in the <code class="language-plaintext highlighter-rouge">:type</code> column.  See https://api.rubyonrails.org/classes/ActiveRecord/Inheritance.html for the official docs on ActiveRecord Inheritance.</p>

<p>STI is heavily used in ManageIQ for provider inventory as it allows for provider plugins to implement things like operations in their own subclasses.</p>

<p>Where this becomes an issue for us here is how STI does queries, let’s look at the SQL that is generated for a simple subclass query:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">CloudManager</span><span class="o">::</span><span class="no">Vm</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">to_sql</span>
<span class="o">=&gt;</span> <span class="s2">"SELECT </span><span class="se">\"</span><span class="s2">vms</span><span class="se">\"</span><span class="s2">.* FROM </span><span class="se">\"</span><span class="s2">vms</span><span class="se">\"</span><span class="s2"> WHERE </span><span class="se">\"</span><span class="s2">vms</span><span class="se">\"</span><span class="s2">.</span><span class="se">\"</span><span class="s2">type</span><span class="se">\"</span><span class="s2"> IN ('ManageIQ::Providers::CloudManager::Vm', 'ManageIQ::Providers::Amazon::CloudManager::Vm', 'ManageIQ::Providers::Azure::CloudManager::Vm', 'ManageIQ::Providers::AzureStack::CloudManager::Vm', 'ManageIQ::Providers::Google::CloudManager::Vm', 'ManageIQ::Providers::IbmCloud::PowerVirtualServers::CloudManager::Vm', 'ManageIQ::Providers::IbmCloud::VPC::CloudManager::Vm', 'ManageIQ::Providers::Openstack::CloudManager::Vm', 'ManageIQ::Providers::IbmCic::CloudManager::Vm', 'ManageIQ::Providers::IbmPowerVc::CloudManager::Vm', 'ManageIQ::Providers::OracleCloud::CloudManager::Vm', 'ManageIQ::Providers::Vmware::CloudManager::Vm') AND </span><span class="se">\"</span><span class="s2">vms</span><span class="se">\"</span><span class="s2">.</span><span class="se">\"</span><span class="s2">template</span><span class="se">\"</span><span class="s2"> = FALSE"</span>
</code></pre></div></div>

<p>By looking for all CloudManager VMs we expect to exclude other types of VMs such as InfraManager ones.  You can see that ActiveRecord accomplishes this by building a query that selects on a number class names.  The list of classes is determined from the descendants of the class we’re checking:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">CloudManager</span><span class="o">::</span><span class="no">Vm</span><span class="p">.</span><span class="nf">descendants</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"ManageIQ::Providers::Amazon::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::Azure::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::AzureStack::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::Google::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::IbmCloud::PowerVirtualServers::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::IbmCloud::VPC::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::Openstack::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::IbmCic::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::IbmPowerVc::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::OracleCloud::CloudManager::Vm"</span><span class="p">,</span> <span class="s2">"ManageIQ::Providers::Vmware::CloudManager::Vm"</span><span class="p">]</span>
</code></pre></div></div>

<p>This is exactly what we want in most cases, however if we’re subclassing another provider such as <code class="language-plaintext highlighter-rouge">ManageIQ::Providers::Openstack::CloudManager::Vm</code>, if we do <code class="language-plaintext highlighter-rouge">ManageIQ::Providers::Openstack::CloudManager::Vm.all</code> we will accidentally retrieve all OpenStack VMs <em>and</em> all subclassed provider VMs.</p>

<p>This is where <code class="language-plaintext highlighter-rouge">ActsAsStiLeafClass</code> comes in.  It overrides the <code class="language-plaintext highlighter-rouge">type_condition</code> method which typically does <code class="language-plaintext highlighter-rouge">sti_names  = ([self] + descendants).map(&amp;:sti_name)</code> to get a list of types, and replaces it with just <code class="language-plaintext highlighter-rouge">[sti_name]</code>.</p>

<h3 id="creating-the-subclasses-1">Creating the subclasses</h3>

<p>After that little detour we can get back to creating our provider.  The summary here is that any class which is a subclass of ActiveRecord::Base must include <code class="language-plaintext highlighter-rouge">Class.include(ActsAsStiLeafClass)</code>.</p>

<p>So if we go back to our base provider (OpenStack) we need to find each <code class="language-plaintext highlighter-rouge">ActiveRecord::Base</code> subclass and create a corresponding subclass in our provider.</p>

<p>Go through the OpenStack cloud_manager/* and for each <code class="language-plaintext highlighter-rouge">ActiveRecord::Base</code> subclass create a file like the following:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">Openstack</span><span class="o">::</span><span class="no">CloudManager</span><span class="o">::</span><span class="no">AuthKeyPair</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">ActsAsStiLeafClass</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ManageIQ::Providers::AwesomePrivateCloud::CloudManager::AuthKeyPair</span> <span class="o">&lt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">Openstack</span><span class="o">::</span><span class="no">CloudManager</span><span class="o">::</span><span class="no">AuthKeyPair</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Followed by a <code class="language-plaintext highlighter-rouge">require_nested :AuthKeyPair</code> in <code class="language-plaintext highlighter-rouge">ManageIQ::Providers::AwesomePrivateCloud::CloudManager</code>.</p>

<p>Rinse and repeat until, in this example, you have:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ManageIQ::Providers::Openstack::CloudManager.include(ActsAsStiLeafClass)

class ManageIQ::Providers::AwesomePrivateCloud::CloudManager &lt; ManageIQ::Providers::Openstack::CloudManager
  require_nested :AuthKeyPair
  require_nested :AvailabilityZone
  require_nested :AvailabilityZoneNull
  require_nested :CloudResourceQuota
  require_nested :CloudTenant
  require_nested :EventCatcher
  require_nested :Flavor
  require_nested :HostAggregate
  require_nested :MetricsCapture
  require_nested :MetricsCollectorWorker
  require_nested :OrchestrationStack
  require_nested :RefreshWorker
  require_nested :Template
  require_nested :Vm
</code></pre></div></div>

<p>Now repeat the process for the <code class="language-plaintext highlighter-rouge">NetworkManager</code> and <code class="language-plaintext highlighter-rouge">StorageManager::CinderManager</code></p>

<p>Lastly create subclasses of all of the <code class="language-plaintext highlighter-rouge">inventory/persister/*</code> classes so that we are able to auto-detect the correct STI type names during refresh.  These are not ActiveRecord classes so simply:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ManageIQ::Providers::AwesomePrivateCloud::Inventory::Persister::CloudManager</span> <span class="o">&lt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">Openstack</span><span class="o">::</span><span class="no">Inventory</span><span class="o">::</span><span class="no">Persister</span><span class="o">::</span><span class="no">CloudManager</span>
<span class="k">end</span>
</code></pre></div></div>
<p>is all you need.</p>

<p>You should be able to run a refresh now without any more code for collection or parsing.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">AwesomePrivateCloud</span><span class="o">::</span><span class="no">CloudManager</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">refresh</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="no">ManageIQ</span><span class="o">::</span><span class="no">Providers</span><span class="o">::</span><span class="no">AwesomePrivateCloud</span><span class="o">::</span><span class="no">CloudManager</span><span class="o">::</span><span class="no">Refresher</span><span class="o">=&gt;</span><span class="p">[</span><span class="c1">#&lt;ManageIQ::Providers::AwesomePrivateCloud::CloudManager id: 12...</span>
</code></pre></div></div>

<p>Now that you have refresh working against a live provider it is time to write some spec tests.</p>

<p>There are already spec tests in core which check a number of common provider concerns that you can run with</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">exec </span>rake app:test:providers_common
</code></pre></div></div>

<p>Next look into writing VCR based refresh spec tests covered in depth here <a href="writing_vcr_specs">Writing VCR Provider Spec Tests</a></p>

      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
  <li>
    <button class="fa theme-toggle" data-toggle-theme></i>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
      
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2023 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58883457-1', 'auto');
  ga('send', 'pageview');

</script>
    
  </body>
</html>
